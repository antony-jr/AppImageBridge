
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>qappimageupdate_p.cc</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/*</a>
<a name="ln2"> * BSD 3-Clause License</a>
<a name="ln3"> *</a>
<a name="ln4"> * Copyright (c) 2018-2019, Antony jr</a>
<a name="ln5"> * All rights reserved.</a>
<a name="ln6"> *</a>
<a name="ln7"> * Redistribution and use in source and binary forms, with or without</a>
<a name="ln8"> * modification, are permitted provided that the following conditions are met:</a>
<a name="ln9"> *</a>
<a name="ln10"> * * Redistributions of source code must retain the above copyright notice, this</a>
<a name="ln11"> *   list of conditions and the following disclaimer.</a>
<a name="ln12"> *</a>
<a name="ln13"> * * Redistributions in binary form must reproduce the above copyright notice,</a>
<a name="ln14"> *   this list of conditions and the following disclaimer in the documentation</a>
<a name="ln15"> *   and/or other materials provided with the distribution.</a>
<a name="ln16"> *</a>
<a name="ln17"> * * Neither the name of the copyright holder nor the names of its</a>
<a name="ln18"> *   contributors may be used to endorse or promote products derived from</a>
<a name="ln19"> *   this software without specific prior written permission.</a>
<a name="ln20"> *</a>
<a name="ln21"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</a>
<a name="ln22"> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</a>
<a name="ln23"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</a>
<a name="ln24"> * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE</a>
<a name="ln25"> * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</a>
<a name="ln26"> * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</a>
<a name="ln27"> * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</a>
<a name="ln28"> * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</a>
<a name="ln29"> * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</a>
<a name="ln30"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</a>
<a name="ln31"> *</a>
<a name="ln32">*/</a>
<a name="ln33"> </a>
<a name="ln34">#include &lt;QCoreApplication&gt;</a>
<a name="ln35"> </a>
<a name="ln36">#include &quot;qappimageupdate_p.hpp&quot;</a>
<a name="ln37">#include &quot;helpers_p.hpp&quot;</a>
<a name="ln38"> </a>
<a name="ln39">#ifndef NO_GUI</a>
<a name="ln40">#include &lt;QApplication&gt;</a>
<a name="ln41">#include &lt;QMessageBox&gt;</a>
<a name="ln42">#include &lt;QProcess&gt;</a>
<a name="ln43">#include &lt;QScreen&gt;</a>
<a name="ln44">#include &lt;QPixmap&gt;</a>
<a name="ln45"> </a>
<a name="ln46">#include &quot;softwareupdatedialog_p.hpp&quot;</a>
<a name="ln47">#include &lt;ui_AppImageUpdaterDialog.h&gt;</a>
<a name="ln48">#endif // NOT NO_GUI</a>
<a name="ln49"> </a>
<a name="ln50"> </a>
<a name="ln51">QAppImageUpdatePrivate::QAppImageUpdatePrivate(bool singleThreaded, QObject *parent)</a>
<a name="ln52">    : QObject(parent) {</a>
<a name="ln53">    setObjectName(&quot;QAppImageUpdatePrivate&quot;);</a>
<a name="ln54">    if(!singleThreaded) {</a>
<a name="ln55">        m_SharedThread.reset(new QThread);</a>
<a name="ln56">        m_SharedThread-&gt;start();</a>
<a name="ln57">    }</a>
<a name="ln58"> </a>
<a name="ln59"> </a>
<a name="ln60">    m_SharedNetworkAccessManager.reset(new QNetworkAccessManager);</a>
<a name="ln61">    m_UpdateInformation.reset(new AppImageUpdateInformationPrivate);</a>
<a name="ln62">    m_DeltaWriter.reset(new ZsyncWriterPrivate(m_SharedNetworkAccessManager.data()));</a>
<a name="ln63">    if(!singleThreaded) {</a>
<a name="ln64">        m_SharedNetworkAccessManager-&gt;moveToThread(m_SharedThread.data());</a>
<a name="ln65">        m_UpdateInformation-&gt;moveToThread(m_SharedThread.data());</a>
<a name="ln66">        m_DeltaWriter-&gt;moveToThread(m_SharedThread.data());</a>
<a name="ln67">    }</a>
<a name="ln68">    m_ControlFileParser.reset(new ZsyncRemoteControlFileParserPrivate(m_SharedNetworkAccessManager.data()));</a>
<a name="ln69">    if(!singleThreaded) {</a>
<a name="ln70">        m_ControlFileParser-&gt;moveToThread(m_SharedThread.data());</a>
<a name="ln71">    }</a>
<a name="ln72">    m_ControlFileParser-&gt;setObjectName(&quot;ZsyncRemoteControlFileParserPrivate&quot;);</a>
<a name="ln73">    m_UpdateInformation-&gt;setObjectName(&quot;AppImageUpdateInformationPrivate&quot;);</a>
<a name="ln74">    m_DeltaWriter-&gt;setObjectName(&quot;ZsyncWriterPrivate&quot;);</a>
<a name="ln75"> </a>
<a name="ln76">    // Set logger name</a>
<a name="ln77">    m_UpdateInformation-&gt;setLoggerName(&quot;UpdateInformation&quot;);</a>
<a name="ln78">    m_ControlFileParser-&gt;setLoggerName(&quot;ControlFileParser&quot;);</a>
<a name="ln79">    m_DeltaWriter-&gt;setLoggerName(&quot;DeltaWriter&quot;);</a>
<a name="ln80"> </a>
<a name="ln81"> </a>
<a name="ln82">    // Update information</a>
<a name="ln83">    connect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::logger,</a>
<a name="ln84">            this, &amp;QAppImageUpdatePrivate::logger,</a>
<a name="ln85">            (Qt::ConnectionType)(Qt::DirectConnection | Qt::UniqueConnection));</a>
<a name="ln86">    connect(m_UpdateInformation.data(), SIGNAL(operatingAppImagePath(QString)),</a>
<a name="ln87">            this, SLOT(setCurrentAppImagePath(QString)),</a>
<a name="ln88">            Qt::QueuedConnection);</a>
<a name="ln89"> </a>
<a name="ln90"> </a>
<a name="ln91">    // Control file parsing</a>
<a name="ln92">    connect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::logger,</a>
<a name="ln93">            this, &amp;QAppImageUpdatePrivate::logger,</a>
<a name="ln94">            (Qt::ConnectionType)(Qt::DirectConnection | Qt::UniqueConnection));</a>
<a name="ln95"> </a>
<a name="ln96">    // Delta Writer and Downloader</a>
<a name="ln97">    connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::logger,</a>
<a name="ln98">            this, &amp;QAppImageUpdatePrivate::logger,</a>
<a name="ln99">            (Qt::ConnectionType)(Qt::DirectConnection | Qt::UniqueConnection));</a>
<a name="ln100">    connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::started,</a>
<a name="ln101">            this, &amp;QAppImageUpdatePrivate::handleUpdateStart,</a>
<a name="ln102">            (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln103"> </a>
<a name="ln104">    // Torrent Downloader Specific</a>
<a name="ln105">    connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::torrentClientStarted,</a>
<a name="ln106">            this, &amp;QAppImageUpdatePrivate::torrentClientStarted ,</a>
<a name="ln107">            (Qt::ConnectionType)(Qt::DirectConnection | Qt::UniqueConnection));</a>
<a name="ln108">    connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::torrentStatus,</a>
<a name="ln109">            this, &amp;QAppImageUpdatePrivate::torrentStatus,</a>
<a name="ln110">            (Qt::ConnectionType)(Qt::DirectConnection | Qt::UniqueConnection));</a>
<a name="ln111">}</a>
<a name="ln112"> </a>
<a name="ln113">QAppImageUpdatePrivate::QAppImageUpdatePrivate(const QString &amp;AppImagePath, bool singleThreaded, QObject *parent)</a>
<a name="ln114">    : QAppImageUpdatePrivate(singleThreaded, parent) {</a>
<a name="ln115">    setAppImage(AppImagePath);</a>
<a name="ln116">    return;</a>
<a name="ln117">}</a>
<a name="ln118"> </a>
<a name="ln119">QAppImageUpdatePrivate::QAppImageUpdatePrivate(QFile *AppImage, bool singleThreaded, QObject *parent)</a>
<a name="ln120">    : QAppImageUpdatePrivate(singleThreaded, parent) {</a>
<a name="ln121">    setAppImage(AppImage);</a>
<a name="ln122">    return;</a>
<a name="ln123">}</a>
<a name="ln124"> </a>
<a name="ln125">QAppImageUpdatePrivate::~QAppImageUpdatePrivate() {</a>
<a name="ln126">    if(b_Started || b_Running) {</a>
<a name="ln127">        cancel();</a>
<a name="ln128">    }</a>
<a name="ln129"> </a>
<a name="ln130">    if(!m_SharedThread.isNull()) {</a>
<a name="ln131">        m_SharedThread-&gt;quit();</a>
<a name="ln132">        m_SharedThread-&gt;wait();</a>
<a name="ln133">    }</a>
<a name="ln134">    return;</a>
<a name="ln135">}</a>
<a name="ln136"> </a>
<a name="ln137">void QAppImageUpdatePrivate::setApplicationName(const QString &amp;applicationName) {</a>
<a name="ln138">    if(b_Started || b_Running) {</a>
<a name="ln139">        return;</a>
<a name="ln140">    }</a>
<a name="ln141">    m_ApplicationName = applicationName;</a>
<a name="ln142">}</a>
<a name="ln143"> </a>
<a name="ln144">void QAppImageUpdatePrivate::setIcon(QByteArray icon) {</a>
<a name="ln145">    if(b_Started || b_Running) {</a>
<a name="ln146">        return;</a>
<a name="ln147">    }</a>
<a name="ln148"> </a>
<a name="ln149">    m_Icon = icon;</a>
<a name="ln150">}</a>
<a name="ln151"> </a>
<a name="ln152">void QAppImageUpdatePrivate::setGuiFlag(int flag) {</a>
<a name="ln153">    if(b_Started || b_Running) {</a>
<a name="ln154">        return;</a>
<a name="ln155">    }</a>
<a name="ln156"> </a>
<a name="ln157">    n_GuiFlag = flag;</a>
<a name="ln158">}</a>
<a name="ln159"> </a>
<a name="ln160">void QAppImageUpdatePrivate::setAppImage(const QString &amp;AppImagePath) {</a>
<a name="ln161">    if(b_Started || b_Running) {</a>
<a name="ln162">        return;</a>
<a name="ln163">    }</a>
<a name="ln164"> </a>
<a name="ln165">    clear();</a>
<a name="ln166">    getMethod(m_UpdateInformation.data(), &quot;setAppImage(const QString&amp;)&quot;)</a>
<a name="ln167">    .invoke(m_UpdateInformation.data(),</a>
<a name="ln168">            Qt::QueuedConnection,</a>
<a name="ln169">            Q_ARG(QString,AppImagePath));</a>
<a name="ln170">    return;</a>
<a name="ln171">}</a>
<a name="ln172"> </a>
<a name="ln173">void QAppImageUpdatePrivate::setAppImage(QFile *AppImage) {</a>
<a name="ln174">    if(b_Started || b_Running) {</a>
<a name="ln175">        return;</a>
<a name="ln176">    }</a>
<a name="ln177"> </a>
<a name="ln178">    clear();</a>
<a name="ln179">    getMethod(m_UpdateInformation.data(), &quot;setAppImage(QFile *)&quot;)</a>
<a name="ln180">    .invoke(m_UpdateInformation.data(),</a>
<a name="ln181">            Qt::QueuedConnection,</a>
<a name="ln182">            Q_ARG(QFile*,AppImage));</a>
<a name="ln183">}</a>
<a name="ln184"> </a>
<a name="ln185">void QAppImageUpdatePrivate::setShowLog(bool choice) {</a>
<a name="ln186">    if(b_Started || b_Running) {</a>
<a name="ln187">        return;</a>
<a name="ln188">    }</a>
<a name="ln189"> </a>
<a name="ln190">    getMethod(m_UpdateInformation.data(), &quot;setShowLog(bool)&quot;)</a>
<a name="ln191">    .invoke(m_UpdateInformation.data(),</a>
<a name="ln192">            Qt::QueuedConnection,</a>
<a name="ln193">            Q_ARG(bool, choice));</a>
<a name="ln194"> </a>
<a name="ln195">    getMethod(m_ControlFileParser.data(), &quot;setShowLog(bool)&quot;)</a>
<a name="ln196">    .invoke(m_ControlFileParser.data(),</a>
<a name="ln197">            Qt::QueuedConnection,</a>
<a name="ln198">            Q_ARG(bool, choice));</a>
<a name="ln199"> </a>
<a name="ln200">    getMethod(m_DeltaWriter.data(), &quot;setShowLog(bool)&quot;)</a>
<a name="ln201">    .invoke(m_DeltaWriter.data(),</a>
<a name="ln202">            Qt::QueuedConnection,</a>
<a name="ln203">            Q_ARG(bool, choice));</a>
<a name="ln204">}</a>
<a name="ln205"> </a>
<a name="ln206">void QAppImageUpdatePrivate::setOutputDirectory(const QString &amp;dir) {</a>
<a name="ln207">    if(b_Started || b_Running) {</a>
<a name="ln208">        return;</a>
<a name="ln209">    }</a>
<a name="ln210"> </a>
<a name="ln211">    getMethod(m_DeltaWriter.data(), &quot;setOutputDirectory(const QString&amp;)&quot;)</a>
<a name="ln212">    .invoke(m_DeltaWriter.data(),</a>
<a name="ln213">            Qt::QueuedConnection,</a>
<a name="ln214">            Q_ARG(QString, dir));</a>
<a name="ln215">    return;</a>
<a name="ln216">}</a>
<a name="ln217"> </a>
<a name="ln218">void QAppImageUpdatePrivate::setProxy(const QNetworkProxy &amp;proxy) {</a>
<a name="ln219">    if(b_Started || b_Running) {</a>
<a name="ln220">        return;</a>
<a name="ln221">    }</a>
<a name="ln222">    m_SharedNetworkAccessManager-&gt;setProxy(proxy);</a>
<a name="ln223">    return;</a>
<a name="ln224">}</a>
<a name="ln225"> </a>
<a name="ln226">void QAppImageUpdatePrivate::clear(void) {</a>
<a name="ln227">    if(b_Started || b_Running) {</a>
<a name="ln228">        return;</a>
<a name="ln229">    }</a>
<a name="ln230"> </a>
<a name="ln231">    b_Started = b_Running = b_Finished = b_Canceled = b_CancelRequested = false;</a>
<a name="ln232">    getMethod(m_UpdateInformation.data(), &quot;clear(void)&quot;)</a>
<a name="ln233">    .invoke(m_UpdateInformation.data(), Qt::QueuedConnection);</a>
<a name="ln234">    getMethod(m_ControlFileParser.data(), &quot;clear(void)&quot;)</a>
<a name="ln235">    .invoke(m_ControlFileParser.data(), Qt::QueuedConnection);</a>
<a name="ln236">    return;</a>
<a name="ln237">}</a>
<a name="ln238"> </a>
<a name="ln239"> </a>
<a name="ln240">void QAppImageUpdatePrivate::start(short action, int flags, QByteArray icon) {</a>
<a name="ln241">    if(b_Started || b_Running) {</a>
<a name="ln242">        return;</a>
<a name="ln243">    }</a>
<a name="ln244"> </a>
<a name="ln245">    b_Started = b_Running = true;</a>
<a name="ln246">    b_Canceled = false;</a>
<a name="ln247">    b_Finished = false;</a>
<a name="ln248"> </a>
<a name="ln249">    if(b_CancelRequested) {</a>
<a name="ln250">        b_Started = b_Running = false;</a>
<a name="ln251">        b_Canceled = true;</a>
<a name="ln252">        b_CancelRequested = false;</a>
<a name="ln253">        emit canceled(action);</a>
<a name="ln254">        return;</a>
<a name="ln255">    }</a>
<a name="ln256"> </a>
<a name="ln257">    if(flags == GuiFlag::None) {</a>
<a name="ln258">        flags = (n_GuiFlag != GuiFlag::None) ? n_GuiFlag : GuiFlag::Default;</a>
<a name="ln259">    }</a>
<a name="ln260">    n_GuiFlag = flags;</a>
<a name="ln261"> </a>
<a name="ln262">    if(icon.isEmpty() &amp;&amp; !m_Icon.isEmpty()) {</a>
<a name="ln263">        icon = m_Icon;</a>
<a name="ln264">    }</a>
<a name="ln265"> </a>
<a name="ln266">    if(action == Action::GetEmbeddedInfo) {</a>
<a name="ln267">        n_CurrentAction = action;</a>
<a name="ln268">        connect(m_UpdateInformation.data(),  &amp;AppImageUpdateInformationPrivate::info,</a>
<a name="ln269">                this, &amp;QAppImageUpdatePrivate::redirectEmbeddedInformation,</a>
<a name="ln270">                Qt::QueuedConnection);</a>
<a name="ln271">        connect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::progress,</a>
<a name="ln272">                this, &amp;QAppImageUpdatePrivate::handleGetEmbeddedInfoProgress);</a>
<a name="ln273">        connect(m_UpdateInformation.data(),  &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln274">                this, &amp;QAppImageUpdatePrivate::handleGetEmbeddedInfoError,</a>
<a name="ln275">                Qt::QueuedConnection);</a>
<a name="ln276"> </a>
<a name="ln277">        emit started(Action::GetEmbeddedInfo);</a>
<a name="ln278">        getMethod(m_UpdateInformation.data(), &quot;getInfo(void)&quot;)</a>
<a name="ln279">        .invoke(m_UpdateInformation.data(), Qt::QueuedConnection);</a>
<a name="ln280"> </a>
<a name="ln281">    } else if(action == Action::CheckForUpdate) {</a>
<a name="ln282">        n_CurrentAction = action;</a>
<a name="ln283"> </a>
<a name="ln284">        //// Needed to check if Bittorrent file is</a>
<a name="ln285">        //// supported.</a>
<a name="ln286">#ifdef DECENTRALIZED_UPDATE_ENABLED</a>
<a name="ln287">        m_ControlFileParser-&gt;setUseBittorrent(true);</a>
<a name="ln288">#else</a>
<a name="ln289">        m_ControlFileParser-&gt;setUseBittorrent(false);</a>
<a name="ln290">#endif</a>
<a name="ln291">        connect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln292">                m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)),</a>
<a name="ln293">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln294"> </a>
<a name="ln295">        connect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln296">                m_ControlFileParser.data(), SLOT(getUpdateCheckInformation(void)),</a>
<a name="ln297">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln298"> </a>
<a name="ln299">        connect(m_ControlFileParser.data(), SIGNAL(updateCheckInformation(QJsonObject)),</a>
<a name="ln300">                this, SLOT(redirectUpdateCheck(QJsonObject)),</a>
<a name="ln301">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln302"> </a>
<a name="ln303">        connect(m_ControlFileParser.data(), SIGNAL(progress(int)),</a>
<a name="ln304">                this, SLOT(handleCheckForUpdateProgress(int)));</a>
<a name="ln305"> </a>
<a name="ln306">        connect(m_ControlFileParser.data(), SIGNAL(error(short)),</a>
<a name="ln307">                this, SLOT(handleCheckForUpdateError(short)),</a>
<a name="ln308">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln309"> </a>
<a name="ln310">        connect(m_UpdateInformation.data(), SIGNAL(error(short)),</a>
<a name="ln311">                this, SLOT(handleCheckForUpdateError(short)),</a>
<a name="ln312">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln313"> </a>
<a name="ln314"> </a>
<a name="ln315">        emit started(Action::CheckForUpdate);</a>
<a name="ln316">        getMethod(m_UpdateInformation.data(), &quot;getInfo(void)&quot;)</a>
<a name="ln317">        .invoke(m_UpdateInformation.data(), Qt::QueuedConnection);</a>
<a name="ln318">    } else if(action == Action::Update || action == Action::UpdateWithTorrent) {</a>
<a name="ln319">        n_CurrentAction = action;</a>
<a name="ln320"> </a>
<a name="ln321">        //// With respect to GDPR, It is strongly adviced</a>
<a name="ln322">        //// to use Torrent only if the user explicitly</a>
<a name="ln323">        //// asks for it.</a>
<a name="ln324">#ifdef DECENTRALIZED_UPDATE_ENABLED</a>
<a name="ln325">        m_ControlFileParser-&gt;setUseBittorrent((action == Action::UpdateWithTorrent));</a>
<a name="ln326">#else</a>
<a name="ln327">        m_ControlFileParser-&gt;setUseBittorrent(false);</a>
<a name="ln328">#endif</a>
<a name="ln329">        connect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln330">                m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)),</a>
<a name="ln331">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln332"> </a>
<a name="ln333">        connect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln334">                m_ControlFileParser.data(), SLOT(getZsyncInformation(void)),</a>
<a name="ln335">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln336"> </a>
<a name="ln337">        connect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::zsyncInformation,</a>
<a name="ln338">                m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::setConfiguration,</a>
<a name="ln339">                (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln340"> </a>
<a name="ln341">        connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finishedConfiguring,</a>
<a name="ln342">                m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::start,</a>
<a name="ln343">                (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln344"> </a>
<a name="ln345">        connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finished,</a>
<a name="ln346">                this, &amp;QAppImageUpdatePrivate::handleUpdateFinished,</a>
<a name="ln347">                (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln348"> </a>
<a name="ln349">        connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::error,</a>
<a name="ln350">                this, &amp;QAppImageUpdatePrivate::handleUpdateError,</a>
<a name="ln351">                (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln352"> </a>
<a name="ln353">        connect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln354">                this, &amp;QAppImageUpdatePrivate::handleUpdateError,</a>
<a name="ln355">                (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln356"> </a>
<a name="ln357">        connect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::error,</a>
<a name="ln358">                this, &amp;QAppImageUpdatePrivate::handleUpdateError,</a>
<a name="ln359">                (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln360"> </a>
<a name="ln361">        connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::progress,</a>
<a name="ln362">                this, &amp;QAppImageUpdatePrivate::handleUpdateProgress,</a>
<a name="ln363">                (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln364"> </a>
<a name="ln365">        connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::canceled,</a>
<a name="ln366">                this, &amp;QAppImageUpdatePrivate::handleUpdateCancel,</a>
<a name="ln367">                (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln368"> </a>
<a name="ln369">        //// Started signal will be emitted by handleUpdateStart</a>
<a name="ln370">        //// which is connected at the construction.</a>
<a name="ln371">        getMethod(m_UpdateInformation.data(), &quot;getInfo(void)&quot;)</a>
<a name="ln372">        .invoke(m_UpdateInformation.data(), Qt::QueuedConnection);</a>
<a name="ln373"> </a>
<a name="ln374">    } else if(action == Action::UpdateWithGUI || action == Action::UpdateWithGUIAndTorrent) {</a>
<a name="ln375">#ifdef NO_GUI</a>
<a name="ln376">        b_Started = b_CancelRequested = b_Finished = b_Canceled = false;</a>
<a name="ln377">        emit error(QAppImageUpdateEnums::Error::UnsupportedActionForBuild, action);</a>
<a name="ln378">        return;</a>
<a name="ln379">#else</a>
<a name="ln380">        n_CurrentAction = action;</a>
<a name="ln381"> </a>
<a name="ln382">        if(m_ApplicationName.isEmpty()) {</a>
<a name="ln383">            m_ApplicationName = QCoreApplication::applicationName();</a>
<a name="ln384">        }</a>
<a name="ln385"> </a>
<a name="ln386">        // Setup GUI if not constructed before</a>
<a name="ln387">        if(!b_GuiClassesConstructed) {</a>
<a name="ln388">            m_UpdaterDialog.reset(new QDialog);</a>
<a name="ln389">            m_UpdaterDialog-&gt;setObjectName(QString::fromUtf8(&quot;AppImageUpdaterDialog&quot;));</a>
<a name="ln390"> </a>
<a name="ln391">            m_Ui = QSharedPointer&lt;Ui::AppImageUpdaterDialog&gt;(new Ui::AppImageUpdaterDialog);</a>
<a name="ln392">            m_Ui-&gt;setupUi(m_UpdaterDialog.data());</a>
<a name="ln393"> </a>
<a name="ln394">            /*</a>
<a name="ln395">             * Default program logic.</a>
<a name="ln396">             */</a>
<a name="ln397"> </a>
<a name="ln398">            connect((m_Ui-&gt;updateCancelBtn), &amp;QPushButton::clicked, this, &amp;QAppImageUpdatePrivate::cancel, Qt::QueuedConnection);</a>
<a name="ln399">            connect(m_UpdaterDialog.data(), &amp;QDialog::rejected, this, &amp;QAppImageUpdatePrivate::cancel, Qt::QueuedConnection);</a>
<a name="ln400"> </a>
<a name="ln401">            b_GuiClassesConstructed = true;</a>
<a name="ln402">        }</a>
<a name="ln403"> </a>
<a name="ln404">        QPixmap icon;</a>
<a name="ln405"> </a>
<a name="ln406">        if(!m_Icon.isEmpty()) {</a>
<a name="ln407">            icon.loadFromData(m_Icon);</a>
<a name="ln408">        }</a>
<a name="ln409"> </a>
<a name="ln410">        /* Set AppImage icon if given. */</a>
<a name="ln411">        if(!icon.isNull()) {</a>
<a name="ln412">            (m_Ui-&gt;softwareIcon)-&gt;setPixmap(icon);</a>
<a name="ln413">            (m_Ui-&gt;softwareIconOnUpdating)-&gt;setPixmap(icon);</a>
<a name="ln414">            m_UpdaterDialog-&gt;setWindowIcon(icon);</a>
<a name="ln415">        } else {</a>
<a name="ln416">            bool found = false;</a>
<a name="ln417">            if(QApplication::windowIcon().isNull()) {</a>
<a name="ln418">                foreach (QWidget *widget, QApplication::allWidgets()) {</a>
<a name="ln419">                    if(!((widget-&gt;windowIcon()).isNull())) {</a>
<a name="ln420">                        icon = widget-&gt;windowIcon().pixmap(100, 100);</a>
<a name="ln421">                        (m_Ui-&gt;softwareIcon)-&gt;setPixmap(icon);</a>
<a name="ln422">                        (m_Ui-&gt;softwareIconOnUpdating)-&gt;setPixmap(icon);</a>
<a name="ln423">                        m_UpdaterDialog-&gt;setWindowIcon(icon);</a>
<a name="ln424">                        found = true;</a>
<a name="ln425">                        break;</a>
<a name="ln426">                    }</a>
<a name="ln427">                    QCoreApplication::processEvents();</a>
<a name="ln428">                }</a>
<a name="ln429">            } else {</a>
<a name="ln430">                icon = QApplication::windowIcon().pixmap(100, 100);</a>
<a name="ln431">                found = true;</a>
<a name="ln432">            }</a>
<a name="ln433"> </a>
<a name="ln434">            if(!found) {</a>
<a name="ln435">                (m_Ui-&gt;softwareIcon)-&gt;setVisible(false);</a>
<a name="ln436">                (m_Ui-&gt;softwareIconOnUpdating)-&gt;setVisible(false);</a>
<a name="ln437">            }</a>
<a name="ln438">        }</a>
<a name="ln439"> </a>
<a name="ln440"> </a>
<a name="ln441"> </a>
<a name="ln442">        m_ConfirmationDialog = QSharedPointer&lt;SoftwareUpdateDialog&gt;(new SoftwareUpdateDialog(nullptr, icon, n_GuiFlag));</a>
<a name="ln443"> </a>
<a name="ln444">#ifdef DECENTRALIZED_UPDATE_ENABLED</a>
<a name="ln445">        m_ControlFileParser-&gt;setUseBittorrent((action == Action::UpdateWithGUIAndTorrent));</a>
<a name="ln446">#else</a>
<a name="ln447">        m_ControlFileParser-&gt;setUseBittorrent(false);</a>
<a name="ln448">#endif</a>
<a name="ln449"> </a>
<a name="ln450">        connect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln451">                m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)),</a>
<a name="ln452">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln453"> </a>
<a name="ln454">        connect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln455">                m_ControlFileParser.data(), SLOT(getUpdateCheckInformation(void)),</a>
<a name="ln456">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln457"> </a>
<a name="ln458">        connect(m_ControlFileParser.data(), SIGNAL(updateCheckInformation(QJsonObject)),</a>
<a name="ln459">                this, SLOT(handleGUIUpdateCheck(QJsonObject)),</a>
<a name="ln460">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln461"> </a>
<a name="ln462">        connect(m_ControlFileParser.data(), SIGNAL(progress(int)),</a>
<a name="ln463">                this, SLOT(handleGUIUpdateCheckProgress(int)),</a>
<a name="ln464">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln465"> </a>
<a name="ln466">        connect(m_ControlFileParser.data(), SIGNAL(error(short)),</a>
<a name="ln467">                this, SLOT(handleGUIUpdateCheckError(short)),</a>
<a name="ln468">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln469"> </a>
<a name="ln470">        connect(m_UpdateInformation.data(), SIGNAL(error(short)),</a>
<a name="ln471">                this, SLOT(handleGUIUpdateCheckError(short)),</a>
<a name="ln472">                (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln473"> </a>
<a name="ln474">        /// First Check for Update</a>
<a name="ln475">        getMethod(m_UpdateInformation.data(), &quot;getInfo(void)&quot;)</a>
<a name="ln476">        .invoke(m_UpdateInformation.data(), Qt::QueuedConnection);</a>
<a name="ln477"> </a>
<a name="ln478">        if(n_GuiFlag &amp; GuiFlag::ShowBeforeProgress) {</a>
<a name="ln479">            (m_Ui-&gt;mainStack)-&gt;setCurrentIndex(0);</a>
<a name="ln480">            showWidget();</a>
<a name="ln481">        }</a>
<a name="ln482">#endif // NO_GUI</a>
<a name="ln483">    } else {</a>
<a name="ln484">        n_CurrentAction = Action::None;</a>
<a name="ln485">        b_Started = b_Running = b_Canceled = false;</a>
<a name="ln486">        emit error(QAppImageUpdateEnums::Error::InvalidAction, n_CurrentAction);</a>
<a name="ln487">    }</a>
<a name="ln488">    return;</a>
<a name="ln489">}</a>
<a name="ln490"> </a>
<a name="ln491">void QAppImageUpdatePrivate::cancel(void) {</a>
<a name="ln492">    if(!b_Started &amp;&amp; !b_Running) {</a>
<a name="ln493">        return;</a>
<a name="ln494">    }</a>
<a name="ln495"> </a>
<a name="ln496">    b_CancelRequested = true;</a>
<a name="ln497">    getMethod(m_DeltaWriter.data(),&quot;cancel()&quot;)</a>
<a name="ln498">    .invoke(m_DeltaWriter.data(), Qt::QueuedConnection);</a>
<a name="ln499">    return;</a>
<a name="ln500">}</a>
<a name="ln501"> </a>
<a name="ln502"> </a>
<a name="ln503">/// * * *</a>
<a name="ln504">/// Private Slots</a>
<a name="ln505">void QAppImageUpdatePrivate::setCurrentAppImagePath(QString path) {</a>
<a name="ln506">    m_CurrentAppImagePath = path;</a>
<a name="ln507">}</a>
<a name="ln508"> </a>
<a name="ln509">void QAppImageUpdatePrivate::handleUpdateProgress(int percentage,</a>
<a name="ln510">        qint64 bytesReceived,</a>
<a name="ln511">        qint64 bytesTotal,</a>
<a name="ln512">        double speed,</a>
<a name="ln513">        QString units) {</a>
<a name="ln514">    emit progress(percentage, bytesReceived, bytesTotal, speed, units, n_CurrentAction);</a>
<a name="ln515">}</a>
<a name="ln516"> </a>
<a name="ln517">void QAppImageUpdatePrivate::handleGetEmbeddedInfoProgress(int percentage) {</a>
<a name="ln518">    emit progress(percentage, 1, 1, 0, QString(), n_CurrentAction);</a>
<a name="ln519">}</a>
<a name="ln520"> </a>
<a name="ln521">void QAppImageUpdatePrivate::handleCheckForUpdateProgress(int percentage) {</a>
<a name="ln522">    emit progress(percentage, 1, 1, 0, QString(), n_CurrentAction);</a>
<a name="ln523">}</a>
<a name="ln524"> </a>
<a name="ln525">void QAppImageUpdatePrivate::handleGetEmbeddedInfoError(short code) {</a>
<a name="ln526">    b_Canceled = b_Started = b_Running = false;</a>
<a name="ln527">    b_Finished = false;</a>
<a name="ln528">    b_CancelRequested = false;</a>
<a name="ln529">    disconnect(m_UpdateInformation.data(),  &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln530">               this, &amp;QAppImageUpdatePrivate::handleGetEmbeddedInfoError);</a>
<a name="ln531">    disconnect(m_UpdateInformation.data(),  &amp;AppImageUpdateInformationPrivate::info,</a>
<a name="ln532">               this, &amp;QAppImageUpdatePrivate::redirectEmbeddedInformation);</a>
<a name="ln533">    disconnect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::progress,</a>
<a name="ln534">               this, &amp;QAppImageUpdatePrivate::handleGetEmbeddedInfoProgress);</a>
<a name="ln535">    emit error(code, n_CurrentAction);</a>
<a name="ln536">}</a>
<a name="ln537"> </a>
<a name="ln538">void QAppImageUpdatePrivate::redirectEmbeddedInformation(QJsonObject info) {</a>
<a name="ln539">    b_Canceled = b_Started = b_Running = false;</a>
<a name="ln540">    b_Finished = true;</a>
<a name="ln541">    disconnect(m_UpdateInformation.data(),  &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln542">               this, &amp;QAppImageUpdatePrivate::handleGetEmbeddedInfoError);</a>
<a name="ln543">    disconnect(m_UpdateInformation.data(),  &amp;AppImageUpdateInformationPrivate::info,</a>
<a name="ln544">               this, &amp;QAppImageUpdatePrivate::redirectEmbeddedInformation);</a>
<a name="ln545">    disconnect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::progress,</a>
<a name="ln546">               this, &amp;QAppImageUpdatePrivate::handleGetEmbeddedInfoProgress);</a>
<a name="ln547"> </a>
<a name="ln548">    if(b_CancelRequested) {</a>
<a name="ln549">        b_CancelRequested = false;</a>
<a name="ln550">        b_Canceled = true;</a>
<a name="ln551">        emit canceled(n_CurrentAction);</a>
<a name="ln552">        return;</a>
<a name="ln553">    }</a>
<a name="ln554">    emit finished(info, n_CurrentAction);</a>
<a name="ln555">}</a>
<a name="ln556"> </a>
<a name="ln557"> </a>
<a name="ln558">void QAppImageUpdatePrivate::handleCheckForUpdateError(short code) {</a>
<a name="ln559">    b_Canceled = b_Started = b_Running = false;</a>
<a name="ln560">    b_Finished = false;</a>
<a name="ln561">    b_CancelRequested = false;</a>
<a name="ln562"> </a>
<a name="ln563">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln564">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln565">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln566">               m_ControlFileParser.data(), SLOT(getUpdateCheckInformation(void)));</a>
<a name="ln567">    disconnect(m_ControlFileParser.data(), SIGNAL(updateCheckInformation(QJsonObject)),</a>
<a name="ln568">               this, SLOT(redirectUpdateCheck(QJsonObject)));</a>
<a name="ln569">    disconnect(m_ControlFileParser.data(), SIGNAL(error(short)),</a>
<a name="ln570">               this, SLOT(handleCheckForUpdateError(short)));</a>
<a name="ln571">    disconnect(m_UpdateInformation.data(), SIGNAL(error(short)),</a>
<a name="ln572">               this, SLOT(handleCheckForUpdateError(short)));</a>
<a name="ln573">    disconnect(m_ControlFileParser.data(), SIGNAL(progress(int)),</a>
<a name="ln574">               this, SLOT(handleCheckForUpdateProgress(int)));</a>
<a name="ln575"> </a>
<a name="ln576">    emit error(code, n_CurrentAction);</a>
<a name="ln577">}</a>
<a name="ln578"> </a>
<a name="ln579">void QAppImageUpdatePrivate::redirectUpdateCheck(QJsonObject info) {</a>
<a name="ln580">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln581">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln582">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln583">               m_ControlFileParser.data(), SLOT(getUpdateCheckInformation(void)));</a>
<a name="ln584">    disconnect(m_ControlFileParser.data(), SIGNAL(updateCheckInformation(QJsonObject)),</a>
<a name="ln585">               this, SLOT(redirectUpdateCheck(QJsonObject)));</a>
<a name="ln586">    disconnect(m_ControlFileParser.data(), SIGNAL(error(short)),</a>
<a name="ln587">               this, SLOT(handleCheckForUpdateError(short)));</a>
<a name="ln588">    disconnect(m_UpdateInformation.data(), SIGNAL(error(short)),</a>
<a name="ln589">               this, SLOT(handleCheckForUpdateError(short)));</a>
<a name="ln590">    disconnect(m_ControlFileParser.data(), SIGNAL(progress(int)),</a>
<a name="ln591">               this, SLOT(handleCheckForUpdateProgress(int)));</a>
<a name="ln592"> </a>
<a name="ln593"> </a>
<a name="ln594">    // Can this happen without an error?</a>
<a name="ln595">    if(info.isEmpty()) {</a>
<a name="ln596">        return;</a>
<a name="ln597">    }</a>
<a name="ln598"> </a>
<a name="ln599">    auto releaseNotes = info[&quot;ReleaseNotes&quot;].toString();</a>
<a name="ln600">    auto embeddedUpdateInformation = info[&quot;EmbededUpdateInformation&quot;].toObject();</a>
<a name="ln601">    auto oldVersionInformation = embeddedUpdateInformation[&quot;FileInformation&quot;].toObject();</a>
<a name="ln602"> </a>
<a name="ln603">    QString remoteTargetFileSHA1Hash = info[&quot;RemoteTargetFileSHA1Hash&quot;].toString(),</a>
<a name="ln604">            localAppImageSHA1Hash = oldVersionInformation[&quot;AppImageSHA1Hash&quot;].toString(),</a>
<a name="ln605">            localAppImagePath = oldVersionInformation[&quot;AppImageFilePath&quot;].toString();</a>
<a name="ln606"> </a>
<a name="ln607">    bool torrentSupported = info[&quot;TorrentSupported&quot;].toBool();</a>
<a name="ln608">    auto torrentFileUrl = info[&quot;TorrentFileUrl&quot;].toString();</a>
<a name="ln609">    auto targetFileName = info[&quot;RemoteTargetFileName&quot;].toString();</a>
<a name="ln610"> </a>
<a name="ln611">    QJsonObject updateinfo {</a>
<a name="ln612">        { &quot;UpdateAvailable&quot;, localAppImageSHA1Hash != remoteTargetFileSHA1Hash},</a>
<a name="ln613">        { &quot;AbsolutePath&quot;, localAppImagePath},</a>
<a name="ln614">	{ &quot;RemoteTargetFileName&quot;, targetFileName}, </a>
<a name="ln615">	{ &quot;LocalSha1Hash&quot;,  localAppImageSHA1Hash },</a>
<a name="ln616">        { &quot;RemoteSha1Hash&quot;, remoteTargetFileSHA1Hash},</a>
<a name="ln617">        { &quot;ReleaseNotes&quot;, releaseNotes},</a>
<a name="ln618">        { &quot;TorrentSupported&quot;, torrentSupported},</a>
<a name="ln619">	{ &quot;TorrentFileUrl&quot;, torrentFileUrl }</a>
<a name="ln620">    };</a>
<a name="ln621"> </a>
<a name="ln622">    b_Started = b_Running = false;</a>
<a name="ln623">    b_Finished = true;</a>
<a name="ln624">    b_Canceled = false;</a>
<a name="ln625"> </a>
<a name="ln626"> </a>
<a name="ln627">    if(b_CancelRequested) {</a>
<a name="ln628">        b_CancelRequested = false;</a>
<a name="ln629">        b_Canceled = true;</a>
<a name="ln630">        emit canceled(n_CurrentAction);</a>
<a name="ln631">        return;</a>
<a name="ln632">    }</a>
<a name="ln633">    emit finished(updateinfo, n_CurrentAction);</a>
<a name="ln634">}</a>
<a name="ln635"> </a>
<a name="ln636">void QAppImageUpdatePrivate::handleUpdateStart() {</a>
<a name="ln637">    emit started(n_CurrentAction);</a>
<a name="ln638">}</a>
<a name="ln639"> </a>
<a name="ln640">void QAppImageUpdatePrivate::handleUpdateCancel() {</a>
<a name="ln641">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln642">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln643">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln644">               m_ControlFileParser.data(), SLOT(getZsyncInformation(void)));</a>
<a name="ln645">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::zsyncInformation,</a>
<a name="ln646">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::setConfiguration);</a>
<a name="ln647">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finishedConfiguring,</a>
<a name="ln648">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::start);</a>
<a name="ln649">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finished,</a>
<a name="ln650">               this, &amp;QAppImageUpdatePrivate::handleUpdateFinished);</a>
<a name="ln651">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::error,</a>
<a name="ln652">               this, &amp;QAppImageUpdatePrivate::handleUpdateError);</a>
<a name="ln653">    disconnect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln654">               this, &amp;QAppImageUpdatePrivate::handleUpdateError);</a>
<a name="ln655">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::error,</a>
<a name="ln656">               this, &amp;QAppImageUpdatePrivate::handleUpdateError);</a>
<a name="ln657">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::progress,</a>
<a name="ln658">               this, &amp;QAppImageUpdatePrivate::handleUpdateProgress);</a>
<a name="ln659">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::canceled,</a>
<a name="ln660">               this, &amp;QAppImageUpdatePrivate::handleUpdateCancel);</a>
<a name="ln661"> </a>
<a name="ln662">    b_Started = b_Running = b_Finished = b_CancelRequested = false;</a>
<a name="ln663">    b_Canceled = true;</a>
<a name="ln664"> </a>
<a name="ln665">    emit canceled(n_CurrentAction);</a>
<a name="ln666"> </a>
<a name="ln667">}</a>
<a name="ln668"> </a>
<a name="ln669">void QAppImageUpdatePrivate::handleUpdateError(short ecode) {</a>
<a name="ln670">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln671">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln672">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln673">               m_ControlFileParser.data(), SLOT(getZsyncInformation(void)));</a>
<a name="ln674">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::zsyncInformation,</a>
<a name="ln675">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::setConfiguration);</a>
<a name="ln676">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finishedConfiguring,</a>
<a name="ln677">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::start);</a>
<a name="ln678">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finished,</a>
<a name="ln679">               this, &amp;QAppImageUpdatePrivate::handleUpdateFinished);</a>
<a name="ln680">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::error,</a>
<a name="ln681">               this, &amp;QAppImageUpdatePrivate::handleUpdateError);</a>
<a name="ln682">    disconnect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln683">               this, &amp;QAppImageUpdatePrivate::handleUpdateError);</a>
<a name="ln684">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::error,</a>
<a name="ln685">               this, &amp;QAppImageUpdatePrivate::handleUpdateError);</a>
<a name="ln686">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::progress,</a>
<a name="ln687">               this, &amp;QAppImageUpdatePrivate::handleUpdateProgress);</a>
<a name="ln688">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::canceled,</a>
<a name="ln689">               this, &amp;QAppImageUpdatePrivate::handleUpdateCancel);</a>
<a name="ln690"> </a>
<a name="ln691"> </a>
<a name="ln692">    b_Started = b_Running = b_Finished = false;</a>
<a name="ln693">    b_Canceled = false;</a>
<a name="ln694"> </a>
<a name="ln695">    if(b_CancelRequested) {</a>
<a name="ln696">        b_CancelRequested = false;</a>
<a name="ln697">        b_Canceled = true;</a>
<a name="ln698">        emit canceled(n_CurrentAction);</a>
<a name="ln699">        return;</a>
<a name="ln700">    }</a>
<a name="ln701"> </a>
<a name="ln702">    emit error(ecode, n_CurrentAction);</a>
<a name="ln703">}</a>
<a name="ln704"> </a>
<a name="ln705">void QAppImageUpdatePrivate::handleUpdateFinished(QJsonObject info, QString oldVersionPath) {</a>
<a name="ln706">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln707">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln708">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln709">               m_ControlFileParser.data(), SLOT(getZsyncInformation(void)));</a>
<a name="ln710">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::zsyncInformation,</a>
<a name="ln711">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::setConfiguration);</a>
<a name="ln712">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finishedConfiguring,</a>
<a name="ln713">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::start);</a>
<a name="ln714">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finished,</a>
<a name="ln715">               this, &amp;QAppImageUpdatePrivate::handleUpdateFinished);</a>
<a name="ln716">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::error,</a>
<a name="ln717">               this, &amp;QAppImageUpdatePrivate::handleUpdateError);</a>
<a name="ln718">    disconnect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln719">               this, &amp;QAppImageUpdatePrivate::handleUpdateError);</a>
<a name="ln720">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::error,</a>
<a name="ln721">               this, &amp;QAppImageUpdatePrivate::handleUpdateError);</a>
<a name="ln722">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::progress,</a>
<a name="ln723">               this, &amp;QAppImageUpdatePrivate::handleUpdateProgress);</a>
<a name="ln724">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::canceled,</a>
<a name="ln725">               this, &amp;QAppImageUpdatePrivate::handleUpdateCancel);</a>
<a name="ln726"> </a>
<a name="ln727"> </a>
<a name="ln728">    QJsonObject result {</a>
<a name="ln729">        {&quot;OldVersionPath&quot;, oldVersionPath},</a>
<a name="ln730">        {&quot;NewVersionPath&quot;, info[&quot;AbsolutePath&quot;].toString()},</a>
<a name="ln731">        {&quot;NewVersionSha1Hash&quot;, info[&quot;Sha1Hash&quot;].toString()},</a>
<a name="ln732">        {&quot;UsedTorrent&quot;, info[&quot;UsedTorrent&quot;].toBool()},</a>
<a name="ln733">	{&quot;TorrentFileUrl&quot;, info[&quot;TorrentFileUrl&quot;].toString()}</a>
<a name="ln734">    };</a>
<a name="ln735">    b_Started = b_Running = false;</a>
<a name="ln736">    b_Finished = true;</a>
<a name="ln737">    b_Canceled = false;</a>
<a name="ln738"> </a>
<a name="ln739">    if(b_CancelRequested) {</a>
<a name="ln740">        b_CancelRequested = false;</a>
<a name="ln741">        b_Canceled = true;</a>
<a name="ln742">        emit canceled(n_CurrentAction);</a>
<a name="ln743">        return;</a>
<a name="ln744">    }</a>
<a name="ln745"> </a>
<a name="ln746">    emit finished(result, n_CurrentAction);</a>
<a name="ln747">}</a>
<a name="ln748"> </a>
<a name="ln749"> </a>
<a name="ln750">/// GUI Update routines.</a>
<a name="ln751"> </a>
<a name="ln752">#ifndef NO_GUI</a>
<a name="ln753">void QAppImageUpdatePrivate::showWidget() {</a>
<a name="ln754">    if(m_Ui.isNull() || m_UpdaterDialog.isNull()) {</a>
<a name="ln755">        return;</a>
<a name="ln756">    }</a>
<a name="ln757">    if(!(n_GuiFlag &amp; GuiFlag::ShowProgressDialog) &amp;&amp;</a>
<a name="ln758">            (m_Ui-&gt;mainStack)-&gt;currentIndex() != 0) {</a>
<a name="ln759">        return;</a>
<a name="ln760">    }</a>
<a name="ln761">    m_UpdaterDialog-&gt;show();</a>
<a name="ln762">    return;</a>
<a name="ln763">}</a>
<a name="ln764"> </a>
<a name="ln765">void QAppImageUpdatePrivate::handleGUIConfirmationRejected() {</a>
<a name="ln766">    handleGUIUpdateCancel();</a>
<a name="ln767">}</a>
<a name="ln768"> </a>
<a name="ln769">void QAppImageUpdatePrivate::handleGUIConfirmationAccepted() {</a>
<a name="ln770">    doGUIUpdate();</a>
<a name="ln771">}</a>
<a name="ln772"> </a>
<a name="ln773">void QAppImageUpdatePrivate::doGUIUpdate() {</a>
<a name="ln774">    connect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln775">            m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)),</a>
<a name="ln776">            (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln777"> </a>
<a name="ln778">    connect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln779">            m_ControlFileParser.data(), SLOT(getZsyncInformation(void)),</a>
<a name="ln780">            (Qt::ConnectionType)(Qt::UniqueConnection | Qt::QueuedConnection));</a>
<a name="ln781"> </a>
<a name="ln782">    connect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::zsyncInformation,</a>
<a name="ln783">            m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::setConfiguration,</a>
<a name="ln784">            (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln785"> </a>
<a name="ln786">    connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finishedConfiguring,</a>
<a name="ln787">            m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::start,</a>
<a name="ln788">            (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln789"> </a>
<a name="ln790">    connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finished,</a>
<a name="ln791">            this, &amp;QAppImageUpdatePrivate::handleGUIUpdateFinished,</a>
<a name="ln792">            (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln793"> </a>
<a name="ln794">    connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::error,</a>
<a name="ln795">            this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError,</a>
<a name="ln796">            (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln797"> </a>
<a name="ln798">    connect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln799">            this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError,</a>
<a name="ln800">            (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln801"> </a>
<a name="ln802">    connect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::error,</a>
<a name="ln803">            this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError,</a>
<a name="ln804">            (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln805"> </a>
<a name="ln806">    connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::progress,</a>
<a name="ln807">            this, &amp;QAppImageUpdatePrivate::handleGUIUpdateProgress,</a>
<a name="ln808">            (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln809"> </a>
<a name="ln810">    connect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::canceled,</a>
<a name="ln811">            this, &amp;QAppImageUpdatePrivate::handleGUIUpdateCancel,</a>
<a name="ln812">            (Qt::ConnectionType)(Qt::QueuedConnection | Qt::UniqueConnection));</a>
<a name="ln813"> </a>
<a name="ln814">    getMethod(m_UpdateInformation.data(), &quot;getInfo(void)&quot;)</a>
<a name="ln815">    .invoke(m_UpdateInformation.data(), Qt::QueuedConnection);</a>
<a name="ln816"> </a>
<a name="ln817"> </a>
<a name="ln818">    showWidget();</a>
<a name="ln819">}</a>
<a name="ln820"> </a>
<a name="ln821">void QAppImageUpdatePrivate::handleGUIUpdateCheck(QJsonObject info) {</a>
<a name="ln822">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln823">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln824"> </a>
<a name="ln825">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln826">               m_ControlFileParser.data(), SLOT(getUpdateCheckInformation(void)));</a>
<a name="ln827">    disconnect(m_ControlFileParser.data(), SIGNAL(updateCheckInformation(QJsonObject)),</a>
<a name="ln828">               this, SLOT(handleGUIUpdateCheck(QJsonObject)));</a>
<a name="ln829">    disconnect(m_ControlFileParser.data(), SIGNAL(progress(int)),</a>
<a name="ln830">               this, SLOT(handleGUIUpdateCheckProgress(int)));</a>
<a name="ln831">    disconnect(m_ControlFileParser.data(), SIGNAL(error(short)),</a>
<a name="ln832">               this, SLOT(handleGUIUpdateCheckError(short)));</a>
<a name="ln833">    disconnect(m_UpdateInformation.data(), SIGNAL(error(short)),</a>
<a name="ln834">               this, SLOT(handleGUIUpdateCheckError(short)));</a>
<a name="ln835"> </a>
<a name="ln836"> </a>
<a name="ln837">    /// Connect confirmation buttons</a>
<a name="ln838">    connect(m_ConfirmationDialog.data(), &amp;SoftwareUpdateDialog::rejected,</a>
<a name="ln839">            this, &amp;QAppImageUpdatePrivate::handleGUIConfirmationRejected, Qt::QueuedConnection);</a>
<a name="ln840">    connect(m_ConfirmationDialog.data(), &amp;SoftwareUpdateDialog::accepted,</a>
<a name="ln841">            this, &amp;QAppImageUpdatePrivate::handleGUIConfirmationAccepted, Qt::QueuedConnection);</a>
<a name="ln842"> </a>
<a name="ln843"> </a>
<a name="ln844"> </a>
<a name="ln845">    if(b_CancelRequested) {</a>
<a name="ln846">        b_Started = b_Running = b_Finished = false;</a>
<a name="ln847">        b_Canceled = false;</a>
<a name="ln848">        b_CancelRequested = false;</a>
<a name="ln849">        b_Canceled = true;</a>
<a name="ln850">        emit canceled(n_CurrentAction);</a>
<a name="ln851">        return;</a>
<a name="ln852">    }</a>
<a name="ln853"> </a>
<a name="ln854"> </a>
<a name="ln855"> </a>
<a name="ln856">    m_UpdaterDialog-&gt;hide();</a>
<a name="ln857">    m_UpdaterDialog-&gt;move(QGuiApplication::primaryScreen()-&gt;geometry().center() - m_UpdaterDialog-&gt;rect().center());</a>
<a name="ln858">    (m_Ui-&gt;mainStack)-&gt;setCurrentIndex(1);</a>
<a name="ln859"> </a>
<a name="ln860">    auto notes = info[&quot;ReleaseNotes&quot;].toString();</a>
<a name="ln861">    auto embeddedUpdateInformation = info[&quot;EmbededUpdateInformation&quot;].toObject();</a>
<a name="ln862">    auto oldVersionInformation = embeddedUpdateInformation[&quot;FileInformation&quot;].toObject();</a>
<a name="ln863"> </a>
<a name="ln864">    QString remoteTargetFileSHA1Hash = info[&quot;RemoteTargetFileSHA1Hash&quot;].toString(),</a>
<a name="ln865">            localAppImageSHA1Hash = oldVersionInformation[&quot;AppImageSHA1Hash&quot;].toString(),</a>
<a name="ln866">            localAppImagePath = oldVersionInformation[&quot;AppImageFilePath&quot;].toString();</a>
<a name="ln867"> </a>
<a name="ln868">    bool torrentSupported = info[&quot;TorrentSupported&quot;].toBool();</a>
<a name="ln869"> </a>
<a name="ln870">    bool showUpdateDialog = n_GuiFlag &amp; GuiFlag::ShowUpdateConfirmationDialog;</a>
<a name="ln871">    bool showNoUpdateDialog = n_GuiFlag &amp; GuiFlag::NotifyWhenNoUpdateIsAvailable;</a>
<a name="ln872">    bool noConfirmTorrentUsage = n_GuiFlag &amp; GuiFlag::NoConfirmTorrentUsage;</a>
<a name="ln873">    m_UpdaterDialog-&gt;setWindowTitle(QString::fromUtf8(&quot;Updating &quot;) +</a>
<a name="ln874">		    		   (m_ApplicationName.isEmpty() ? </a>
<a name="ln875">				    QFileInfo(localAppImagePath).baseName() : </a>
<a name="ln876">				    m_ApplicationName));</a>
<a name="ln877"> </a>
<a name="ln878">    bool isUpdateAvailable = (localAppImageSHA1Hash != remoteTargetFileSHA1Hash);</a>
<a name="ln879"> </a>
<a name="ln880"> </a>
<a name="ln881">    if(isUpdateAvailable) {</a>
<a name="ln882">        if(torrentSupported) {</a>
<a name="ln883">            bool permission = true;</a>
<a name="ln884">            if(!noConfirmTorrentUsage) {</a>
<a name="ln885">                QMessageBox box(m_UpdaterDialog.data());</a>
<a name="ln886">                box.setWindowTitle(QString::fromUtf8(&quot;Torrent Usage Permission&quot;));</a>
<a name="ln887">                box.setIcon(QMessageBox::Information);</a>
<a name="ln888">                box.setText(</a>
<a name="ln889">                    QString::fromUtf8(</a>
<a name="ln890">                        &quot;It seems that the author of &quot;) +</a>
<a name="ln891">                    (m_ApplicationName.isEmpty() ? QFileInfo(localAppImagePath).baseName() : </a>
<a name="ln892">		     m_ApplicationName) +</a>
<a name="ln893">                    QString::fromUtf8(&quot; supports decentralized update via Bittorrent.&quot;) +</a>
<a name="ln894">                    QString::fromUtf8(</a>
<a name="ln895">                        &quot; Do you agree to &lt;b&gt;use Bittorrent for decentralized update?&lt;/b&gt; This is completely optional.&quot;) +</a>
<a name="ln896">                    QString::fromUtf8(</a>
<a name="ln897">                        &quot; &lt;b&gt;Please click 'No' if you don't understand the question&lt;/b&gt;.&quot;)</a>
<a name="ln898">                );</a>
<a name="ln899">                box.addButton(QMessageBox::Yes);</a>
<a name="ln900">                box.addButton(QMessageBox::No);</a>
<a name="ln901">                permission = (box.exec() == QMessageBox::Yes);</a>
<a name="ln902"> </a>
<a name="ln903">            }</a>
<a name="ln904"> </a>
<a name="ln905">            if(!permission) {</a>
<a name="ln906">                m_ControlFileParser-&gt;setUseBittorrent(false);</a>
<a name="ln907">            }</a>
<a name="ln908">        }</a>
<a name="ln909">        if(showUpdateDialog) {</a>
<a name="ln910">            QString oldSha = localAppImageSHA1Hash,</a>
<a name="ln911">                    newSha = remoteTargetFileSHA1Hash;</a>
<a name="ln912">            /* we don't need the full sha to show the diff. */</a>
<a name="ln913">            oldSha.resize(7);</a>
<a name="ln914">            newSha.resize(7);</a>
<a name="ln915"> </a>
<a name="ln916">            oldSha = oldSha.toLower();</a>
<a name="ln917">            newSha = newSha.toLower();</a>
<a name="ln918"> </a>
<a name="ln919">            m_ConfirmationDialog-&gt;init( m_ApplicationName, oldSha, newSha, notes);</a>
<a name="ln920">        } else {</a>
<a name="ln921">            // Auto confirm if we are not showing the confirm dialog.</a>
<a name="ln922">            doGUIUpdate();</a>
<a name="ln923">        }</a>
<a name="ln924">    } else {</a>
<a name="ln925">        if(showNoUpdateDialog) {</a>
<a name="ln926">            QMessageBox box(m_UpdaterDialog.data());</a>
<a name="ln927">            box.setWindowTitle(QString::fromUtf8(&quot;No Updates Available!&quot;));</a>
<a name="ln928">            box.setText(</a>
<a name="ln929">                QString::fromUtf8(&quot;You are currently using the lastest version of &quot;) +\</a>
<a name="ln930">		(m_ApplicationName.isEmpty() ? QFileInfo(localAppImagePath).fileName()</a>
<a name="ln931">		 : m_ApplicationName ) +</a>
<a name="ln932">                QString::fromUtf8(&quot;.&quot;));</a>
<a name="ln933">            box.exec();</a>
<a name="ln934">        }</a>
<a name="ln935"> </a>
<a name="ln936">        QJsonObject result {</a>
<a name="ln937">            {&quot;OldVersionPath&quot;, localAppImagePath},</a>
<a name="ln938">            {&quot;NewVersionPath&quot;, localAppImagePath},</a>
<a name="ln939">            {&quot;NewVersionSha1Hash&quot;, localAppImageSHA1Hash},</a>
<a name="ln940">            {&quot;UsedTorrent&quot;, false}</a>
<a name="ln941">        };</a>
<a name="ln942">        b_Started = b_Running = false;</a>
<a name="ln943">        b_Finished = true;</a>
<a name="ln944">        b_Canceled = false;</a>
<a name="ln945"> </a>
<a name="ln946">        emit finished(result, n_CurrentAction);</a>
<a name="ln947">    }</a>
<a name="ln948"> </a>
<a name="ln949">}</a>
<a name="ln950"> </a>
<a name="ln951"> </a>
<a name="ln952"> </a>
<a name="ln953">void QAppImageUpdatePrivate::handleGUIUpdateCheckError(short ecode) {</a>
<a name="ln954">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln955">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln956"> </a>
<a name="ln957">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln958">               m_ControlFileParser.data(), SLOT(getUpdateCheckInformation(void)));</a>
<a name="ln959">    disconnect(m_ControlFileParser.data(), SIGNAL(updateCheckInformation(QJsonObject)),</a>
<a name="ln960">               this, SLOT(handleGUIUpdateCheck(QJsonObject)));</a>
<a name="ln961">    disconnect(m_ControlFileParser.data(), SIGNAL(progress(int)),</a>
<a name="ln962">               this, SLOT(handleGUIUpdateCheckProgress(int)));</a>
<a name="ln963">    disconnect(m_ControlFileParser.data(), SIGNAL(error(short)),</a>
<a name="ln964">               this, SLOT(handleGUIUpdateCheckError(short)));</a>
<a name="ln965">    disconnect(m_UpdateInformation.data(), SIGNAL(error(short)),</a>
<a name="ln966">               this, SLOT(handleGUIUpdateCheckError(short)));</a>
<a name="ln967"> </a>
<a name="ln968">    if(b_CancelRequested) {</a>
<a name="ln969">        b_Started = b_Running = b_Finished = false;</a>
<a name="ln970">        b_Canceled = false;</a>
<a name="ln971">        b_CancelRequested = false;</a>
<a name="ln972">        b_Canceled = true;</a>
<a name="ln973">        emit canceled(n_CurrentAction);</a>
<a name="ln974">        return;</a>
<a name="ln975">    }</a>
<a name="ln976"> </a>
<a name="ln977">    bool show = n_GuiFlag &amp; GuiFlag::ShowErrorDialog;</a>
<a name="ln978"> </a>
<a name="ln979"> </a>
<a name="ln980">    QString errorString = QAppImageUpdatePrivate::errorCodeToDescriptionString(ecode);</a>
<a name="ln981">    if(ecode == QAppImageUpdateEnums::Error::NoReadPermission ||</a>
<a name="ln982">            ecode == QAppImageUpdateEnums::Error::NoPermissionToReadSourceFile ||</a>
<a name="ln983">            ecode == QAppImageUpdateEnums::Error::NoPermissionToReadWriteTargetFile) {</a>
<a name="ln984">        if(n_GuiFlag &amp; GuiFlag::NoShowErrorDialogOnPermissionErrors) {</a>
<a name="ln985">            show = false;</a>
<a name="ln986">        }</a>
<a name="ln987">    }</a>
<a name="ln988"> </a>
<a name="ln989">    if(show) {</a>
<a name="ln990">        QMessageBox box(m_UpdaterDialog.data());</a>
<a name="ln991">        box.setWindowTitle(QString::fromUtf8(&quot;Update Failed&quot;));</a>
<a name="ln992">        box.setIcon(QMessageBox::Critical);</a>
<a name="ln993">        box.setText(QString::fromUtf8(&quot;Update failed for '&quot;) +</a>
<a name="ln994">                    QFileInfo(m_CurrentAppImagePath).fileName() +</a>
<a name="ln995">                    QString::fromUtf8(&quot;': &quot;) + errorString);</a>
<a name="ln996">        box.exec();</a>
<a name="ln997">    }</a>
<a name="ln998"> </a>
<a name="ln999"> </a>
<a name="ln1000">    emit error(ecode, n_CurrentAction);</a>
<a name="ln1001">    m_UpdaterDialog-&gt;hide();</a>
<a name="ln1002">    return;</a>
<a name="ln1003">}</a>
<a name="ln1004"> </a>
<a name="ln1005">void QAppImageUpdatePrivate::handleGUIUpdateCheckProgress(int percentage) {</a>
<a name="ln1006">	Q_UNUSED(percentage);</a>
<a name="ln1007">}</a>
<a name="ln1008"> </a>
<a name="ln1009"> </a>
<a name="ln1010">void QAppImageUpdatePrivate::handleGUIUpdateProgress(int percentage,</a>
<a name="ln1011">        qint64 bytesReceived,</a>
<a name="ln1012">        qint64 bytesTotal,</a>
<a name="ln1013">        double speed,</a>
<a name="ln1014">        QString units) {</a>
<a name="ln1015">    //// Show that we are canceling if cancel was requested.</a>
<a name="ln1016">    if(b_CancelRequested) {</a>
<a name="ln1017">        (m_Ui-&gt;updateSpeedLbl)-&gt;setText(QString::fromUtf8(&quot;Rolling back changes, Please wait... &quot;));</a>
<a name="ln1018">        return;</a>
<a name="ln1019">    }</a>
<a name="ln1020"> </a>
<a name="ln1021">    (m_Ui-&gt;progressBar)-&gt;setValue(percentage);</a>
<a name="ln1022">    double MegaBytesReceived = bytesReceived / 1048576;</a>
<a name="ln1023">    double MegaBytesTotal = bytesTotal / 1048576;</a>
<a name="ln1024">    const QString progressTemplate = QString::fromUtf8(&quot;Updating %1 MiB of %2 MiB at %3 %4...&quot;);</a>
<a name="ln1025">    QString statusText = progressTemplate.arg(MegaBytesReceived).arg(MegaBytesTotal).arg(speed).arg(units);</a>
<a name="ln1026">    (m_Ui-&gt;updateSpeedLbl)-&gt;setText(statusText);</a>
<a name="ln1027">}</a>
<a name="ln1028"> </a>
<a name="ln1029"> </a>
<a name="ln1030">void QAppImageUpdatePrivate::handleGUIUpdateStart() {</a>
<a name="ln1031">    emit started(n_CurrentAction);</a>
<a name="ln1032">}</a>
<a name="ln1033"> </a>
<a name="ln1034">void QAppImageUpdatePrivate::handleGUIUpdateCancel() {</a>
<a name="ln1035">    m_UpdaterDialog-&gt;hide();</a>
<a name="ln1036"> </a>
<a name="ln1037">    disconnect(m_ConfirmationDialog.data(), &amp;SoftwareUpdateDialog::rejected,</a>
<a name="ln1038">               this, &amp;QAppImageUpdatePrivate::handleGUIConfirmationRejected);</a>
<a name="ln1039">    disconnect(m_ConfirmationDialog.data(), &amp;SoftwareUpdateDialog::accepted,</a>
<a name="ln1040">               this, &amp;QAppImageUpdatePrivate::handleGUIConfirmationAccepted);</a>
<a name="ln1041"> </a>
<a name="ln1042">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln1043">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln1044"> </a>
<a name="ln1045">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln1046">               m_ControlFileParser.data(), SLOT(getZsyncInformation(void)));</a>
<a name="ln1047"> </a>
<a name="ln1048">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::zsyncInformation,</a>
<a name="ln1049">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::setConfiguration);</a>
<a name="ln1050"> </a>
<a name="ln1051">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finishedConfiguring,</a>
<a name="ln1052">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::start);</a>
<a name="ln1053"> </a>
<a name="ln1054">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finished,</a>
<a name="ln1055">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateFinished);</a>
<a name="ln1056"> </a>
<a name="ln1057">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::error,</a>
<a name="ln1058">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError);</a>
<a name="ln1059"> </a>
<a name="ln1060">    disconnect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln1061">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError);</a>
<a name="ln1062"> </a>
<a name="ln1063">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::error,</a>
<a name="ln1064">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError);</a>
<a name="ln1065"> </a>
<a name="ln1066">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::progress,</a>
<a name="ln1067">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateProgress);</a>
<a name="ln1068"> </a>
<a name="ln1069">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::canceled,</a>
<a name="ln1070">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateCancel);</a>
<a name="ln1071"> </a>
<a name="ln1072">    b_Started = b_Running = b_Finished = b_CancelRequested = false;</a>
<a name="ln1073">    b_Canceled = true;</a>
<a name="ln1074"> </a>
<a name="ln1075">    emit canceled(n_CurrentAction);</a>
<a name="ln1076">}</a>
<a name="ln1077"> </a>
<a name="ln1078">void QAppImageUpdatePrivate::handleGUIUpdateError(short ecode) {</a>
<a name="ln1079">    disconnect(m_ConfirmationDialog.data(), &amp;SoftwareUpdateDialog::rejected,</a>
<a name="ln1080">               this, &amp;QAppImageUpdatePrivate::handleGUIConfirmationRejected);</a>
<a name="ln1081">    disconnect(m_ConfirmationDialog.data(), &amp;SoftwareUpdateDialog::accepted,</a>
<a name="ln1082">               this, &amp;QAppImageUpdatePrivate::handleGUIConfirmationAccepted);</a>
<a name="ln1083"> </a>
<a name="ln1084">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln1085">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln1086"> </a>
<a name="ln1087">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln1088">               m_ControlFileParser.data(), SLOT(getZsyncInformation(void)));</a>
<a name="ln1089"> </a>
<a name="ln1090">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::zsyncInformation,</a>
<a name="ln1091">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::setConfiguration);</a>
<a name="ln1092"> </a>
<a name="ln1093">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finishedConfiguring,</a>
<a name="ln1094">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::start);</a>
<a name="ln1095"> </a>
<a name="ln1096">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finished,</a>
<a name="ln1097">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateFinished);</a>
<a name="ln1098"> </a>
<a name="ln1099">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::error,</a>
<a name="ln1100">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError);</a>
<a name="ln1101"> </a>
<a name="ln1102">    disconnect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln1103">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError);</a>
<a name="ln1104"> </a>
<a name="ln1105">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::error,</a>
<a name="ln1106">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError);</a>
<a name="ln1107"> </a>
<a name="ln1108">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::progress,</a>
<a name="ln1109">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateProgress);</a>
<a name="ln1110"> </a>
<a name="ln1111">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::canceled,</a>
<a name="ln1112">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateCancel);</a>
<a name="ln1113"> </a>
<a name="ln1114"> </a>
<a name="ln1115">    b_Started = b_Running = b_Finished = false;</a>
<a name="ln1116">    b_Canceled = false;</a>
<a name="ln1117"> </a>
<a name="ln1118">    if(b_CancelRequested) {</a>
<a name="ln1119">        b_CancelRequested = false;</a>
<a name="ln1120">        b_Canceled = true;</a>
<a name="ln1121">        emit canceled(n_CurrentAction);</a>
<a name="ln1122">        return;</a>
<a name="ln1123">    }</a>
<a name="ln1124"> </a>
<a name="ln1125">    bool show = n_GuiFlag &amp; GuiFlag::ShowErrorDialog;</a>
<a name="ln1126"> </a>
<a name="ln1127"> </a>
<a name="ln1128">    QString errorString = QAppImageUpdatePrivate::errorCodeToDescriptionString(ecode);</a>
<a name="ln1129">    if(ecode == QAppImageUpdateEnums::Error::NoReadPermission ||</a>
<a name="ln1130">            ecode == QAppImageUpdateEnums::Error::NoPermissionToReadSourceFile ||</a>
<a name="ln1131">            ecode == QAppImageUpdateEnums::Error::NoPermissionToReadWriteTargetFile) {</a>
<a name="ln1132">        if(n_GuiFlag &amp; GuiFlag::NoShowErrorDialogOnPermissionErrors) {</a>
<a name="ln1133">            show = false;</a>
<a name="ln1134">        }</a>
<a name="ln1135">    }</a>
<a name="ln1136"> </a>
<a name="ln1137">    if(show) {</a>
<a name="ln1138">        QMessageBox box(m_UpdaterDialog.data());</a>
<a name="ln1139">        box.setWindowTitle(QString::fromUtf8(&quot;Update Failed&quot;));</a>
<a name="ln1140">        box.setIcon(QMessageBox::Critical);</a>
<a name="ln1141">        box.setText(QString::fromUtf8(&quot;Update failed for '&quot;) +</a>
<a name="ln1142">                    (m_ApplicationName.isEmpty() ? QFileInfo(m_CurrentAppImagePath).fileName() : m_ApplicationName) +</a>
<a name="ln1143">                    QString::fromUtf8(&quot;': &quot;) + errorString);</a>
<a name="ln1144">        box.exec();</a>
<a name="ln1145">    }</a>
<a name="ln1146"> </a>
<a name="ln1147"> </a>
<a name="ln1148">    emit error(ecode, n_CurrentAction);</a>
<a name="ln1149">    m_UpdaterDialog-&gt;hide();</a>
<a name="ln1150">    return;</a>
<a name="ln1151">}</a>
<a name="ln1152"> </a>
<a name="ln1153">void QAppImageUpdatePrivate::handleGUIUpdateFinished(QJsonObject info, QString oldVersionPath) {</a>
<a name="ln1154">    disconnect(m_ConfirmationDialog.data(), &amp;SoftwareUpdateDialog::rejected,</a>
<a name="ln1155">               this, &amp;QAppImageUpdatePrivate::handleGUIConfirmationRejected);</a>
<a name="ln1156">    disconnect(m_ConfirmationDialog.data(), &amp;SoftwareUpdateDialog::accepted,</a>
<a name="ln1157">               this, &amp;QAppImageUpdatePrivate::handleGUIConfirmationAccepted);</a>
<a name="ln1158"> </a>
<a name="ln1159">    disconnect(m_UpdateInformation.data(), SIGNAL(info(QJsonObject)),</a>
<a name="ln1160">               m_ControlFileParser.data(), SLOT(setControlFileUrl(QJsonObject)));</a>
<a name="ln1161"> </a>
<a name="ln1162">    disconnect(m_ControlFileParser.data(), SIGNAL(receiveControlFile(void)),</a>
<a name="ln1163">               m_ControlFileParser.data(), SLOT(getZsyncInformation(void)));</a>
<a name="ln1164"> </a>
<a name="ln1165">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::zsyncInformation,</a>
<a name="ln1166">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::setConfiguration);</a>
<a name="ln1167"> </a>
<a name="ln1168">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finishedConfiguring,</a>
<a name="ln1169">               m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::start);</a>
<a name="ln1170"> </a>
<a name="ln1171">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::finished,</a>
<a name="ln1172">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateFinished);</a>
<a name="ln1173"> </a>
<a name="ln1174">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::error,</a>
<a name="ln1175">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError);</a>
<a name="ln1176"> </a>
<a name="ln1177">    disconnect(m_UpdateInformation.data(), &amp;AppImageUpdateInformationPrivate::error,</a>
<a name="ln1178">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError);</a>
<a name="ln1179"> </a>
<a name="ln1180">    disconnect(m_ControlFileParser.data(), &amp;ZsyncRemoteControlFileParserPrivate::error,</a>
<a name="ln1181">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateError);</a>
<a name="ln1182"> </a>
<a name="ln1183">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::progress,</a>
<a name="ln1184">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateProgress);</a>
<a name="ln1185"> </a>
<a name="ln1186">    disconnect(m_DeltaWriter.data(), &amp;ZsyncWriterPrivate::canceled,</a>
<a name="ln1187">               this, &amp;QAppImageUpdatePrivate::handleGUIUpdateCancel);</a>
<a name="ln1188"> </a>
<a name="ln1189"> </a>
<a name="ln1190"> </a>
<a name="ln1191">    QJsonObject result {</a>
<a name="ln1192">        {&quot;OldVersionPath&quot;, oldVersionPath},</a>
<a name="ln1193">        {&quot;NewVersionPath&quot;, info[&quot;AbsolutePath&quot;].toString()},</a>
<a name="ln1194">        {&quot;NewVersionSha1Hash&quot;, info[&quot;Sha1Hash&quot;].toString()},</a>
<a name="ln1195">        {&quot;UsedTorrent&quot;, info[&quot;UsedTorrent&quot;].toBool()}</a>
<a name="ln1196">    };</a>
<a name="ln1197">    b_Started = b_Running = false;</a>
<a name="ln1198">    b_Finished = true;</a>
<a name="ln1199">    b_Canceled = false;</a>
<a name="ln1200"> </a>
<a name="ln1201">    if(b_CancelRequested) {</a>
<a name="ln1202">        QFile::remove(info[&quot;AbsolutePath&quot;].toString());</a>
<a name="ln1203"> </a>
<a name="ln1204">        b_CancelRequested = false;</a>
<a name="ln1205">        b_Canceled = true;</a>
<a name="ln1206">        emit canceled(n_CurrentAction);</a>
<a name="ln1207">        return;</a>
<a name="ln1208">    }</a>
<a name="ln1209"> </a>
<a name="ln1210">    (m_Ui-&gt;updateSpeedLbl)-&gt;setText(QString::fromUtf8(&quot;Finalizing Update... &quot;));</a>
<a name="ln1211"> </a>
<a name="ln1212">    bool execute = false;</a>
<a name="ln1213">    bool show = n_GuiFlag &amp; GuiFlag::ShowFinishedDialog;</a>
<a name="ln1214"> </a>
<a name="ln1215">    if(show) {</a>
<a name="ln1216">        auto curinfo = QFileInfo(oldVersionPath);</a>
<a name="ln1217">        QString currentAppImageName = curinfo.fileName();</a>
<a name="ln1218">        QString currentAppImageAbsPath = curinfo.absolutePath();</a>
<a name="ln1219"> </a>
<a name="ln1220">        QMessageBox box(m_UpdaterDialog.data());</a>
<a name="ln1221">        box.setWindowTitle(QString::fromUtf8(&quot;Update Completed&quot;));</a>
<a name="ln1222">        box.setIcon(QMessageBox::Information);</a>
<a name="ln1223">        box.setDetailedText(</a>
<a name="ln1224">            QString::fromUtf8(&quot;Old version is at: &quot;) +</a>
<a name="ln1225">            currentAppImageAbsPath + QString::fromUtf8(&quot;/&quot;) + currentAppImageName +</a>
<a name="ln1226">            QString::fromUtf8(&quot;\n\n&quot;) +</a>
<a name="ln1227">            QString::fromUtf8(&quot;New version is saved at: &quot;) +</a>
<a name="ln1228">            result[&quot;NewVersionPath&quot;].toString());</a>
<a name="ln1229">        box.setText(QString::fromUtf8(&quot;Update completed successfully for &lt;b&gt;&quot;) +</a>
<a name="ln1230">                    (m_ApplicationName.isEmpty() ? currentAppImageName : m_ApplicationName) +</a>
<a name="ln1231">                    QString::fromUtf8(&quot;&lt;/b&gt;, do you want to launch the new version? View details for more information.&quot;));</a>
<a name="ln1232">        box.addButton(QMessageBox::Yes);</a>
<a name="ln1233">        box.addButton(QMessageBox::No);</a>
<a name="ln1234">        execute = (box.exec() == QMessageBox::Yes);</a>
<a name="ln1235">    }</a>
<a name="ln1236"> </a>
<a name="ln1237">    if(execute) {</a>
<a name="ln1238">        QFileInfo info(result[&quot;NewVersionPath&quot;].toString());</a>
<a name="ln1239">        if(!info.isExecutable()) {</a>
<a name="ln1240">            {</a>
<a name="ln1241">                QFile file(result[&quot;NewVersionPath&quot;].toString());</a>
<a name="ln1242">                file.setPermissions(QFileDevice::ExeUser |</a>
<a name="ln1243">                                    QFileDevice::ExeOther|</a>
<a name="ln1244">                                    QFileDevice::ExeGroup|</a>
<a name="ln1245">                                    info.permissions());</a>
<a name="ln1246">            }</a>
<a name="ln1247">        }</a>
<a name="ln1248"> </a>
<a name="ln1249"> </a>
<a name="ln1250">        //// The delay is set to 5 seconds</a>
<a name="ln1251">        QProcess::startDetached(&quot;sh&quot;,</a>
<a name="ln1252">                                QStringList()</a>
<a name="ln1253">                                &lt;&lt; &quot;-c&quot;</a>
<a name="ln1254">                                &lt;&lt; (</a>
<a name="ln1255">                                    QString::fromUtf8(&quot;sleep &quot;) +</a>
<a name="ln1256">                                    QString::number(5) +</a>
<a name="ln1257">                                    QString::fromUtf8(&quot;; &quot;) +</a>
<a name="ln1258">                                    result[&quot;NewVersionPath&quot;].toString()</a>
<a name="ln1259">                                ));</a>
<a name="ln1260">        m_UpdaterDialog-&gt;hide();</a>
<a name="ln1261">        emit quit();</a>
<a name="ln1262">    }</a>
<a name="ln1263">    m_UpdaterDialog-&gt;hide();</a>
<a name="ln1264">    emit finished(result, n_CurrentAction);</a>
<a name="ln1265">    return;</a>
<a name="ln1266">}</a>
<a name="ln1267">#endif // NOT NO_GUI</a>
<a name="ln1268"> </a>
<a name="ln1269">//// Static Methods</a>
<a name="ln1270">QString QAppImageUpdatePrivate::errorCodeToString(short errorCode) {</a>
<a name="ln1271">    QString ret = &quot;QAppImageUpdate::Error::&quot;;</a>
<a name="ln1272">    switch(errorCode) {</a>
<a name="ln1273">    case QAppImageUpdateEnums::Error::NoAppimagePathGiven:</a>
<a name="ln1274">        ret += &quot;NoAppImagePathGiven&quot;;</a>
<a name="ln1275">        break;</a>
<a name="ln1276">    case QAppImageUpdateEnums::Error::AppimageNotReadable:</a>
<a name="ln1277">        ret += &quot;AppImageNotReadable&quot;;</a>
<a name="ln1278">        break;</a>
<a name="ln1279">    case QAppImageUpdateEnums::Error::NoReadPermission:</a>
<a name="ln1280">        ret += &quot;NoReadPermission&quot;;</a>
<a name="ln1281">        break;</a>
<a name="ln1282">    case QAppImageUpdateEnums::Error::AppimageNotFound:</a>
<a name="ln1283">        ret += &quot;AppimageNotFound&quot;;</a>
<a name="ln1284">        break;</a>
<a name="ln1285">    case QAppImageUpdateEnums::Error::CannotOpenAppimage:</a>
<a name="ln1286">        ret += &quot;CannnotOpenAppimage&quot;;</a>
<a name="ln1287">        break;</a>
<a name="ln1288">    case QAppImageUpdateEnums::Error::EmptyUpdateInformation:</a>
<a name="ln1289">        ret += &quot;EmptyUpdateInformation&quot;;</a>
<a name="ln1290">        break;</a>
<a name="ln1291">    case QAppImageUpdateEnums::Error::InvalidAppimageType:</a>
<a name="ln1292">        ret += &quot;InvalidAppimageType&quot;;</a>
<a name="ln1293">        break;</a>
<a name="ln1294">    case QAppImageUpdateEnums::Error::InvalidMagicBytes:</a>
<a name="ln1295">        ret += &quot;InvalidMagicBytes&quot;;</a>
<a name="ln1296">        break;</a>
<a name="ln1297">    case QAppImageUpdateEnums::Error::InvalidUpdateInformation:</a>
<a name="ln1298">        ret += &quot;InvalidUpdateInformation&quot;;</a>
<a name="ln1299">        break;</a>
<a name="ln1300">    case QAppImageUpdateEnums::Error::NotEnoughMemory:</a>
<a name="ln1301">        ret += &quot;NotEnoughMemory&quot;;</a>
<a name="ln1302">        break;</a>
<a name="ln1303">    case QAppImageUpdateEnums::Error::SectionHeaderNotFound:</a>
<a name="ln1304">        ret += &quot;SectionHeaderNotFound&quot;;</a>
<a name="ln1305">        break;</a>
<a name="ln1306">    case QAppImageUpdateEnums::Error::UnsupportedElfFormat:</a>
<a name="ln1307">        ret += &quot;UnsupportedElfFormat&quot;;</a>
<a name="ln1308">        break;</a>
<a name="ln1309">    case QAppImageUpdateEnums::Error::UnsupportedTransport:</a>
<a name="ln1310">        ret += &quot;UnsupportedTransport&quot;;</a>
<a name="ln1311">        break;</a>
<a name="ln1312">    case QAppImageUpdateEnums::Error::UnknownNetworkError:</a>
<a name="ln1313">        ret += &quot;UnknownNetworkError&quot;;</a>
<a name="ln1314">        break;</a>
<a name="ln1315">    case QAppImageUpdateEnums::Error::IoReadError:</a>
<a name="ln1316">        ret += &quot;IoReadError&quot;;</a>
<a name="ln1317">        break;</a>
<a name="ln1318">    case QAppImageUpdateEnums::Error::ErrorResponseCode:</a>
<a name="ln1319">        ret += &quot;ErrorResponseCode&quot;;</a>
<a name="ln1320">        break;</a>
<a name="ln1321">    case QAppImageUpdateEnums::Error::GithubApiRateLimitReached:</a>
<a name="ln1322">        ret += &quot;GithubApiRateLimitReached&quot;;</a>
<a name="ln1323">        break;</a>
<a name="ln1324">    case QAppImageUpdateEnums::Error::NoMarkerFoundInControlFile:</a>
<a name="ln1325">        ret += &quot;NoMarkerFoundInControlFile&quot;;</a>
<a name="ln1326">        break;</a>
<a name="ln1327">    case QAppImageUpdateEnums::Error::InvalidZsyncHeadersNumber:</a>
<a name="ln1328">        ret += &quot;InvalidZsyncHeadersNumber&quot;;</a>
<a name="ln1329">        break;</a>
<a name="ln1330">    case QAppImageUpdateEnums::Error::InvalidZsyncMakeVersion:</a>
<a name="ln1331">        ret += &quot;InvalidZsyncMakeVersion&quot;;</a>
<a name="ln1332">        break;</a>
<a name="ln1333">    case QAppImageUpdateEnums::Error::InvalidZsyncTargetFilename:</a>
<a name="ln1334">        ret += &quot;InvalidZsyncTargetFilename&quot;;</a>
<a name="ln1335">        break;</a>
<a name="ln1336">    case QAppImageUpdateEnums::Error::InvalidZsyncMtime:</a>
<a name="ln1337">        ret += &quot;InvalidZsyncMtime&quot;;</a>
<a name="ln1338">        break;</a>
<a name="ln1339">    case QAppImageUpdateEnums::Error::InvalidZsyncBlocksize:</a>
<a name="ln1340">        ret += &quot;InvalidZsyncBlocksize&quot;;</a>
<a name="ln1341">        break;</a>
<a name="ln1342">    case QAppImageUpdateEnums::Error::InvalidTargetFileLength:</a>
<a name="ln1343">        ret += &quot;InvalidTargetFileLength&quot;;</a>
<a name="ln1344">        break;</a>
<a name="ln1345">    case QAppImageUpdateEnums::Error::InvalidHashLengthLine:</a>
<a name="ln1346">        ret += &quot;InvalidHashLengthLine&quot;;</a>
<a name="ln1347">        break;</a>
<a name="ln1348">    case QAppImageUpdateEnums::Error::InvalidHashLengths:</a>
<a name="ln1349">        ret += &quot;InvalidHashLengths&quot;;</a>
<a name="ln1350">        break;</a>
<a name="ln1351">    case QAppImageUpdateEnums::Error::InvalidTargetFileUrl:</a>
<a name="ln1352">        ret += &quot;InvalidTargetFileUrl&quot;;</a>
<a name="ln1353">        break;</a>
<a name="ln1354">    case QAppImageUpdateEnums::Error::InvalidTargetFileSha1:</a>
<a name="ln1355">        ret += &quot;InvalidTargetFileSha1&quot;;</a>
<a name="ln1356">        break;</a>
<a name="ln1357">    case QAppImageUpdateEnums::Error::ConnectionRefusedError:</a>
<a name="ln1358">        ret += &quot;ConnectionRefusedError&quot;;</a>
<a name="ln1359">        break;</a>
<a name="ln1360">    case QAppImageUpdateEnums::Error::RemoteHostClosedError:</a>
<a name="ln1361">        ret += &quot;RemoteHostClosedError&quot;;</a>
<a name="ln1362">        break;</a>
<a name="ln1363">    case QAppImageUpdateEnums::Error::HostNotFoundError:</a>
<a name="ln1364">        ret += &quot;HostNotFoundError&quot;;</a>
<a name="ln1365">        break;</a>
<a name="ln1366">    case QAppImageUpdateEnums::Error::TimeoutError:</a>
<a name="ln1367">        ret += &quot;TimeoutError&quot;;</a>
<a name="ln1368">        break;</a>
<a name="ln1369">    case QAppImageUpdateEnums::Error::OperationCanceledError:</a>
<a name="ln1370">        ret += &quot;OperationCanceledError&quot;;</a>
<a name="ln1371">        break;</a>
<a name="ln1372">    case QAppImageUpdateEnums::Error::SslHandshakeFailedError:</a>
<a name="ln1373">        ret += &quot;SslHandshakeFailedError&quot;;</a>
<a name="ln1374">        break;</a>
<a name="ln1375">    case QAppImageUpdateEnums::Error::TemporaryNetworkFailureError:</a>
<a name="ln1376">        ret += &quot;TemporaryNetworkFailureError&quot;;</a>
<a name="ln1377">        break;</a>
<a name="ln1378">    case QAppImageUpdateEnums::Error::NetworkSessionFailedError:</a>
<a name="ln1379">        ret += &quot;NetworkSessionFailedError&quot;;</a>
<a name="ln1380">        break;</a>
<a name="ln1381">    case QAppImageUpdateEnums::Error::BackgroundRequestNotAllowedError:</a>
<a name="ln1382">        ret += &quot;BackgroundRequestNotAllowedError&quot;;</a>
<a name="ln1383">        break;</a>
<a name="ln1384">    case QAppImageUpdateEnums::Error::TooManyRedirectsError:</a>
<a name="ln1385">        ret += &quot;TooManyRedirectsError&quot;;</a>
<a name="ln1386">        break;</a>
<a name="ln1387">    case QAppImageUpdateEnums::Error::InsecureRedirectError:</a>
<a name="ln1388">        ret += &quot;InsecureRedirectError&quot;;</a>
<a name="ln1389">        break;</a>
<a name="ln1390">    case QAppImageUpdateEnums::Error::ProxyConnectionRefusedError:</a>
<a name="ln1391">        ret += &quot;ProxyConnectionRefusedError&quot;;</a>
<a name="ln1392">        break;</a>
<a name="ln1393">    case QAppImageUpdateEnums::Error::ProxyConnectionClosedError:</a>
<a name="ln1394">        ret += &quot;ProxyConnectionClosedError&quot;;</a>
<a name="ln1395">        break;</a>
<a name="ln1396">    case QAppImageUpdateEnums::Error::ProxyNotFoundError:</a>
<a name="ln1397">        ret += &quot;ProxyNotFoundError&quot;;</a>
<a name="ln1398">        break;</a>
<a name="ln1399">    case QAppImageUpdateEnums::Error::ProxyTimeoutError:</a>
<a name="ln1400">        ret += &quot;ProxyTimeoutError&quot;;</a>
<a name="ln1401">        break;</a>
<a name="ln1402">    case QAppImageUpdateEnums::Error::ProxyAuthenticationRequiredError:</a>
<a name="ln1403">        ret += &quot;ProxyAuthenticationRequiredError&quot;;</a>
<a name="ln1404">        break;</a>
<a name="ln1405">    case QAppImageUpdateEnums::Error::ContentAccessDenied:</a>
<a name="ln1406">        ret += &quot;ContentAccessDenied&quot;;</a>
<a name="ln1407">        break;</a>
<a name="ln1408">    case QAppImageUpdateEnums::Error::ContentOperationNotPermittedError:</a>
<a name="ln1409">        ret += &quot;ContentOperationNotPermittedError&quot;;</a>
<a name="ln1410">        break;</a>
<a name="ln1411">    case QAppImageUpdateEnums::Error::ContentNotFoundError:</a>
<a name="ln1412">        ret += &quot;ContentNotFoundError&quot;;</a>
<a name="ln1413">        break;</a>
<a name="ln1414">    case QAppImageUpdateEnums::Error::AuthenticationRequiredError:</a>
<a name="ln1415">        ret += &quot;AuthenticationRequiredError&quot;;</a>
<a name="ln1416">        break;</a>
<a name="ln1417">    case QAppImageUpdateEnums::Error::ContentReSendError:</a>
<a name="ln1418">        ret += &quot;ContentReSendError&quot;;</a>
<a name="ln1419">        break;</a>
<a name="ln1420">    case QAppImageUpdateEnums::Error::ContentConflictError:</a>
<a name="ln1421">        ret += &quot;ContentConflictError&quot;;</a>
<a name="ln1422">        break;</a>
<a name="ln1423">    case QAppImageUpdateEnums::Error::ContentGoneError:</a>
<a name="ln1424">        ret += &quot;ContentGoneError&quot;;</a>
<a name="ln1425">        break;</a>
<a name="ln1426">    case QAppImageUpdateEnums::Error::InternalServerError:</a>
<a name="ln1427">        ret += &quot;InternalServerError&quot;;</a>
<a name="ln1428">        break;</a>
<a name="ln1429">    case QAppImageUpdateEnums::Error::OperationNotImplementedError:</a>
<a name="ln1430">        ret += &quot;OperationNotImplementedError&quot;;</a>
<a name="ln1431">        break;</a>
<a name="ln1432">    case QAppImageUpdateEnums::Error::ServiceUnavailableError:</a>
<a name="ln1433">        ret += &quot;ServiceUnavailableError&quot;;</a>
<a name="ln1434">        break;</a>
<a name="ln1435">    case QAppImageUpdateEnums::Error::ProtocolUnknownError:</a>
<a name="ln1436">        ret += &quot;ProtocolUnknownError&quot;;</a>
<a name="ln1437">        break;</a>
<a name="ln1438">    case QAppImageUpdateEnums::Error::ProtocolInvalidOperationError:</a>
<a name="ln1439">        ret += &quot;ProtocolInvalidOperationError&quot;;</a>
<a name="ln1440">        break;</a>
<a name="ln1441">    case QAppImageUpdateEnums::Error::UnknownProxyError:</a>
<a name="ln1442">        ret += &quot;UnknownProxyError&quot;;</a>
<a name="ln1443">        break;</a>
<a name="ln1444">    case QAppImageUpdateEnums::Error::UnknownContentError:</a>
<a name="ln1445">        ret += &quot;UnknownContentError&quot;;</a>
<a name="ln1446">        break;</a>
<a name="ln1447">    case QAppImageUpdateEnums::Error::ProtocolFailure:</a>
<a name="ln1448">        ret += &quot;ProtocolFailure&quot;;</a>
<a name="ln1449">        break;</a>
<a name="ln1450">    case QAppImageUpdateEnums::Error::UnknownServerError:</a>
<a name="ln1451">        ret += &quot;UnknownServerError&quot;;</a>
<a name="ln1452">        break;</a>
<a name="ln1453">    case QAppImageUpdateEnums::Error::ZsyncControlFileNotFound:</a>
<a name="ln1454">        ret += &quot;ZsyncControlFileNotFound&quot;;</a>
<a name="ln1455">        break;</a>
<a name="ln1456">    case QAppImageUpdateEnums::Error::HashTableNotAllocated:</a>
<a name="ln1457">        ret += &quot;HashTableNotAllocated&quot;;</a>
<a name="ln1458">        break;</a>
<a name="ln1459">    case QAppImageUpdateEnums::Error::InvalidTargetFileChecksumBlocks:</a>
<a name="ln1460">        ret += &quot;InvalidTargetFileChecksumBlocks&quot;;</a>
<a name="ln1461">        break;</a>
<a name="ln1462">    case QAppImageUpdateEnums::Error::CannotConstructHashTable:</a>
<a name="ln1463">        ret += &quot;CannotConstructHashTable&quot;;</a>
<a name="ln1464">        break;</a>
<a name="ln1465">    case QAppImageUpdateEnums::Error::CannotOpenTargetFileChecksumBlocks:</a>
<a name="ln1466">        ret += &quot;CannotOpenTargetFileChecksumBlocks&quot;;</a>
<a name="ln1467">        break;</a>
<a name="ln1468">    case QAppImageUpdateEnums::Error::QbufferIoReadError:</a>
<a name="ln1469">        ret += &quot;QbufferIoReadError&quot;;</a>
<a name="ln1470">        break;</a>
<a name="ln1471">    case QAppImageUpdateEnums::Error::SourceFileNotFound:</a>
<a name="ln1472">        ret += &quot;SourceFileNotFound&quot;;</a>
<a name="ln1473">        break;</a>
<a name="ln1474">    case QAppImageUpdateEnums::Error::NoPermissionToReadSourceFile:</a>
<a name="ln1475">        ret += &quot;NoPermissionToReadSourceFile&quot;;</a>
<a name="ln1476">        break;</a>
<a name="ln1477">    case QAppImageUpdateEnums::Error::CannotOpenSourceFile:</a>
<a name="ln1478">        ret += &quot;CannotOpenSourceFile&quot;;</a>
<a name="ln1479">        break;</a>
<a name="ln1480">    case QAppImageUpdateEnums::Error::NoPermissionToReadWriteTargetFile:</a>
<a name="ln1481">        ret += &quot;NoPermissionToReadWriteTargetFile&quot;;</a>
<a name="ln1482">        break;</a>
<a name="ln1483">    case QAppImageUpdateEnums::Error::CannotOpenTargetFile:</a>
<a name="ln1484">        ret += &quot;CannotOpenTargetFile&quot;;</a>
<a name="ln1485">        break;</a>
<a name="ln1486">    case QAppImageUpdateEnums::Error::TargetFileSha1HashMismatch:</a>
<a name="ln1487">        ret += &quot;TargetFileSha1HashMismatch&quot;;</a>
<a name="ln1488">        break;</a>
<a name="ln1489">    case QAppImageUpdateEnums::Error::UnsupportedActionForBuild:</a>
<a name="ln1490">        ret += &quot;UnsupportedActionForBuild&quot;;</a>
<a name="ln1491">        break;</a>
<a name="ln1492">    case QAppImageUpdateEnums::Error::InvalidAction:</a>
<a name="ln1493">        ret += &quot;InvalidAction&quot;;</a>
<a name="ln1494">        break;</a>
<a name="ln1495">    default:</a>
<a name="ln1496">        ret += &quot;Unknown&quot;;</a>
<a name="ln1497">        break;</a>
<a name="ln1498">    }</a>
<a name="ln1499">    return ret;</a>
<a name="ln1500">}</a>
<a name="ln1501"> </a>
<a name="ln1502">QString QAppImageUpdatePrivate::errorCodeToDescriptionString(short errorCode) {</a>
<a name="ln1503">    QString errorString;</a>
<a name="ln1504">    switch(errorCode) {</a>
<a name="ln1505">    case QAppImageUpdateEnums::Error::ConnectionRefusedError:</a>
<a name="ln1506">        errorString = QString::fromUtf8(&quot;The update server is not accepting requests.&quot;);</a>
<a name="ln1507">        break;</a>
<a name="ln1508">    case QAppImageUpdateEnums::Error::RemoteHostClosedError:</a>
<a name="ln1509">        errorString = QString::fromUtf8(&quot;The remote server closed the connection prematurely, &quot;);</a>
<a name="ln1510">        errorString += QString::fromUtf8(&quot;before the entire reply was received and processed.&quot;);</a>
<a name="ln1511">        break;</a>
<a name="ln1512">    case QAppImageUpdateEnums::Error::HostNotFoundError:</a>
<a name="ln1513">        errorString = QString::fromUtf8(&quot;The remote host name was not found (invalid hostname).&quot;);</a>
<a name="ln1514">        break;</a>
<a name="ln1515">    case QAppImageUpdateEnums::Error::TimeoutError:</a>
<a name="ln1516">        errorString = QString::fromUtf8(&quot;The connection to the remote server timed out.&quot;);</a>
<a name="ln1517">        break;</a>
<a name="ln1518">    case QAppImageUpdateEnums::Error::SslHandshakeFailedError:</a>
<a name="ln1519">        errorString = QString::fromUtf8(&quot;The SSL/TLS handshake failed and the encrypted channel &quot;);</a>
<a name="ln1520">        errorString += QString::fromUtf8(&quot;could not be established.&quot;);</a>
<a name="ln1521">        break;</a>
<a name="ln1522">    case QAppImageUpdateEnums::Error::TemporaryNetworkFailureError:</a>
<a name="ln1523">        errorString = QString::fromUtf8(&quot;The connection to the network was broken.&quot;);</a>
<a name="ln1524">        break;</a>
<a name="ln1525">    case QAppImageUpdateEnums::Error::NetworkSessionFailedError:</a>
<a name="ln1526">        errorString = QString::fromUtf8(&quot;The connection to the network was broken &quot;);</a>
<a name="ln1527">        errorString += QString::fromUtf8(&quot;or could not be initiated.&quot;);</a>
<a name="ln1528">        break;</a>
<a name="ln1529">    case QAppImageUpdateEnums::Error::BackgroundRequestNotAllowedError:</a>
<a name="ln1530">        errorString = QString::fromUtf8(&quot;The background request is not currently allowed due to platform policy.&quot;);</a>
<a name="ln1531">        break;</a>
<a name="ln1532">    case QAppImageUpdateEnums::Error::TooManyRedirectsError:</a>
<a name="ln1533">        errorString = QString::fromUtf8(&quot;While following redirects, the maximum limit was reached.&quot;);</a>
<a name="ln1534">        break;</a>
<a name="ln1535">    case QAppImageUpdateEnums::Error::InsecureRedirectError:</a>
<a name="ln1536">        errorString = QString::fromUtf8(&quot;While following redirects, there was a redirect &quot;);</a>
<a name="ln1537">        errorString += QString::fromUtf8(&quot;from a encrypted protocol (https) to an unencrypted one (http).&quot;);</a>
<a name="ln1538">        break;</a>
<a name="ln1539">    case QAppImageUpdateEnums::Error::ContentAccessDenied:</a>
<a name="ln1540">        errorString = QString::fromUtf8(&quot;The access to the remote content was denied (HTTP error 403).&quot;);</a>
<a name="ln1541">        break;</a>
<a name="ln1542">    case QAppImageUpdateEnums::Error::ContentOperationNotPermittedError:</a>
<a name="ln1543">        errorString = QString::fromUtf8(&quot;The operation requested on the remote content is not permitted.&quot;);</a>
<a name="ln1544">        break;</a>
<a name="ln1545">    case QAppImageUpdateEnums::Error::ContentNotFoundError:</a>
<a name="ln1546">        errorString = QString::fromUtf8(&quot;The remote content was not found at the server (HTTP error 404)&quot;);</a>
<a name="ln1547">        break;</a>
<a name="ln1548">    case QAppImageUpdateEnums::Error::AuthenticationRequiredError:</a>
<a name="ln1549">        errorString = QString::fromUtf8(&quot;The remote server requires authentication to serve the content, &quot;);</a>
<a name="ln1550">        errorString += QString::fromUtf8(&quot;but the credentials provided were not accepted or given.&quot;);</a>
<a name="ln1551">        break;</a>
<a name="ln1552">    case QAppImageUpdateEnums::Error::ContentConflictError:</a>
<a name="ln1553">        errorString = QString::fromUtf8(&quot;The request could not be completed due to a conflict with the &quot;);</a>
<a name="ln1554">        errorString += QString::fromUtf8(&quot;current state of the resource.&quot;);</a>
<a name="ln1555">        break;</a>
<a name="ln1556">    case QAppImageUpdateEnums::Error::ContentGoneError:</a>
<a name="ln1557">        errorString = QString::fromUtf8(&quot;The requested resource is no longer available at the server.&quot;);</a>
<a name="ln1558">        break;</a>
<a name="ln1559">    case QAppImageUpdateEnums::Error::InternalServerError:</a>
<a name="ln1560">        errorString = QString::fromUtf8(&quot;The server encountered an unexpected condition which prevented &quot;);</a>
<a name="ln1561">        errorString += QString::fromUtf8(&quot;it from fulfilling the request.&quot;);</a>
<a name="ln1562">        break;</a>
<a name="ln1563">    case QAppImageUpdateEnums::Error::OperationNotImplementedError:</a>
<a name="ln1564">        errorString = QString::fromUtf8(&quot;The server does not support the functionality required to fulfill the request.&quot;);</a>
<a name="ln1565">        break;</a>
<a name="ln1566">    case QAppImageUpdateEnums::Error::ServiceUnavailableError:</a>
<a name="ln1567">        errorString = QString::fromUtf8(&quot;The server is unable to handle the request at this time.&quot;);</a>
<a name="ln1568">        break;</a>
<a name="ln1569">    case QAppImageUpdateEnums::Error::ProtocolUnknownError:</a>
<a name="ln1570">        errorString = QString::fromUtf8(&quot;The Network Access API cannot honor the request because the protocol&quot;);</a>
<a name="ln1571">        errorString += QString::fromUtf8(&quot; is not known.&quot;);</a>
<a name="ln1572">        break;</a>
<a name="ln1573">    case QAppImageUpdateEnums::Error::ProtocolInvalidOperationError:</a>
<a name="ln1574">        errorString = QString::fromUtf8(&quot;The requested operation is invalid for this protocol.&quot;);</a>
<a name="ln1575">        break;</a>
<a name="ln1576">    case QAppImageUpdateEnums::Error::UnknownNetworkError:</a>
<a name="ln1577">        errorString = QString::fromUtf8(&quot;An unknown network-related error was detected.&quot;);</a>
<a name="ln1578">        break;</a>
<a name="ln1579">    case QAppImageUpdateEnums::Error::UnknownContentError:</a>
<a name="ln1580">        errorString = QString::fromUtf8(&quot;An unknown error related to the remote content was detected.&quot;);</a>
<a name="ln1581">        break;</a>
<a name="ln1582">    case QAppImageUpdateEnums::Error::ProtocolFailure:</a>
<a name="ln1583">        errorString = QString::fromUtf8(&quot;A breakdown in protocol was detected &quot;);</a>
<a name="ln1584">        errorString += QString::fromUtf8(&quot;(parsing error, invalid or unexpected responses, etc.)&quot;);</a>
<a name="ln1585">        break;</a>
<a name="ln1586">    case QAppImageUpdateEnums::Error::UnknownServerError:</a>
<a name="ln1587">        errorString = QString::fromUtf8(&quot;An unknown error related to the server response was detected.&quot;);</a>
<a name="ln1588">        break;</a>
<a name="ln1589">    case QAppImageUpdateEnums::Error::NoAppimagePathGiven:</a>
<a name="ln1590">        errorString = QString::fromUtf8(&quot;No AppImage given.&quot;);</a>
<a name="ln1591">        break;</a>
<a name="ln1592">    case QAppImageUpdateEnums::Error::AppimageNotReadable:</a>
<a name="ln1593">        errorString = QString::fromUtf8(&quot;The AppImage is not readable.&quot;);</a>
<a name="ln1594">        break;</a>
<a name="ln1595">    case QAppImageUpdateEnums::Error::NoReadPermission:</a>
<a name="ln1596">        errorString = QString::fromUtf8(&quot;You don't have the permission to read the AppImage.&quot;);</a>
<a name="ln1597">        break;</a>
<a name="ln1598">    case QAppImageUpdateEnums::Error::AppimageNotFound:</a>
<a name="ln1599">        errorString = QString::fromUtf8(&quot;The AppImage does not exist.&quot;);</a>
<a name="ln1600">        break;</a>
<a name="ln1601">    case QAppImageUpdateEnums::Error::CannotOpenAppimage:</a>
<a name="ln1602">        errorString = QString::fromUtf8(&quot;The AppImage cannot be opened.&quot;);</a>
<a name="ln1603">        break;</a>
<a name="ln1604">    case QAppImageUpdateEnums::Error::EmptyUpdateInformation:</a>
<a name="ln1605">        errorString = QString::fromUtf8(&quot;The AppImage does not include any update information.&quot;);</a>
<a name="ln1606">        break;</a>
<a name="ln1607">    case QAppImageUpdateEnums::Error::InvalidAppimageType:</a>
<a name="ln1608">        errorString = QString::fromUtf8(&quot;The AppImage has an unknown type.&quot;);</a>
<a name="ln1609">        break;</a>
<a name="ln1610">    case QAppImageUpdateEnums::Error::InvalidMagicBytes:</a>
<a name="ln1611">        errorString = QString::fromUtf8(&quot;The AppImage is not valid.&quot;);</a>
<a name="ln1612">        break;</a>
<a name="ln1613">    case QAppImageUpdateEnums::Error::InvalidUpdateInformation:</a>
<a name="ln1614">        errorString = QString::fromUtf8(&quot;The AppImage has invalid update information.&quot;);</a>
<a name="ln1615">        break;</a>
<a name="ln1616">    case QAppImageUpdateEnums::Error::NotEnoughMemory:</a>
<a name="ln1617">        errorString = QString::fromUtf8(&quot;Not enough memory.&quot;);</a>
<a name="ln1618">        break;</a>
<a name="ln1619">    case QAppImageUpdateEnums::Error::SectionHeaderNotFound:</a>
<a name="ln1620">        errorString = QString::fromUtf8(&quot;The AppImage does not contain update information &quot;);</a>
<a name="ln1621">        errorString += QString::fromUtf8(&quot;at a valid section header.&quot;);</a>
<a name="ln1622">        break;</a>
<a name="ln1623">    case QAppImageUpdateEnums::Error::UnsupportedElfFormat:</a>
<a name="ln1624">        errorString = QString::fromUtf8(&quot;The AppImage is not in supported ELF format.&quot;);</a>
<a name="ln1625">        break;</a>
<a name="ln1626">    case QAppImageUpdateEnums::Error::UnsupportedTransport:</a>
<a name="ln1627">        errorString = QString::fromUtf8(&quot;The AppImage specifies an unsupported update transport.&quot;);</a>
<a name="ln1628">        break;</a>
<a name="ln1629">    case QAppImageUpdateEnums::Error::IoReadError:</a>
<a name="ln1630">        errorString = QString::fromUtf8(&quot;Unknown IO read error.&quot;);</a>
<a name="ln1631">        break;</a>
<a name="ln1632">    case QAppImageUpdateEnums::Error::GithubApiRateLimitReached:</a>
<a name="ln1633">        errorString = QString::fromUtf8(&quot;GitHub API rate limit reached, please try again later.&quot;);</a>
<a name="ln1634">        break;</a>
<a name="ln1635">    case QAppImageUpdateEnums::Error::ErrorResponseCode:</a>
<a name="ln1636">        errorString = QString::fromUtf8(&quot;Bad response from the server, please try again later.&quot;);</a>
<a name="ln1637">        break;</a>
<a name="ln1638">    case QAppImageUpdateEnums::Error::NoMarkerFoundInControlFile:</a>
<a name="ln1639">    case QAppImageUpdateEnums::Error::InvalidZsyncHeadersNumber:</a>
<a name="ln1640">    case QAppImageUpdateEnums::Error::InvalidZsyncMakeVersion:</a>
<a name="ln1641">    case QAppImageUpdateEnums::Error::InvalidZsyncTargetFilename:</a>
<a name="ln1642">    case QAppImageUpdateEnums::Error::InvalidZsyncMtime:</a>
<a name="ln1643">    case QAppImageUpdateEnums::Error::InvalidZsyncBlocksize:</a>
<a name="ln1644">    case QAppImageUpdateEnums::Error::InvalidTargetFileLength:</a>
<a name="ln1645">    case QAppImageUpdateEnums::Error::InvalidHashLengthLine:</a>
<a name="ln1646">    case QAppImageUpdateEnums::Error::InvalidHashLengths:</a>
<a name="ln1647">    case QAppImageUpdateEnums::Error::InvalidTargetFileUrl:</a>
<a name="ln1648">    case QAppImageUpdateEnums::Error::InvalidTargetFileSha1:</a>
<a name="ln1649">    case QAppImageUpdateEnums::Error::HashTableNotAllocated:</a>
<a name="ln1650">    case QAppImageUpdateEnums::Error::InvalidTargetFileChecksumBlocks:</a>
<a name="ln1651">    case QAppImageUpdateEnums::Error::CannotOpenTargetFileChecksumBlocks:</a>
<a name="ln1652">    case QAppImageUpdateEnums::Error::CannotConstructHashTable:</a>
<a name="ln1653">    case QAppImageUpdateEnums::Error::QbufferIoReadError:</a>
<a name="ln1654">        errorString = QString::fromUtf8(&quot;Invalid zsync meta file.&quot;);</a>
<a name="ln1655">        break;</a>
<a name="ln1656">    case QAppImageUpdateEnums::Error::ZsyncControlFileNotFound:</a>
<a name="ln1657">        errorString = QString::fromUtf8(&quot;The zsync control file was not found in the specified location.&quot;);</a>
<a name="ln1658">        break;</a>
<a name="ln1659">    case QAppImageUpdateEnums::Error::SourceFileNotFound:</a>
<a name="ln1660">        errorString = QString::fromUtf8(&quot;The current AppImage could not be found, maybe it was deleted while updating?&quot;);</a>
<a name="ln1661">        break;</a>
<a name="ln1662">    case QAppImageUpdateEnums::Error::NoPermissionToReadSourceFile:</a>
<a name="ln1663">        errorString = QString::fromUtf8(&quot;You don't have the permission to read the current AppImage.&quot;);</a>
<a name="ln1664">        break;</a>
<a name="ln1665">    case QAppImageUpdateEnums::Error::CannotOpenSourceFile:</a>
<a name="ln1666">        errorString = QString::fromUtf8(&quot;The current AppImage cannot be opened.&quot;);</a>
<a name="ln1667">        break;</a>
<a name="ln1668">    case QAppImageUpdateEnums::Error::NoPermissionToReadWriteTargetFile:</a>
<a name="ln1669">        errorString = QString::fromUtf8(&quot;You have no write or read permissions for the new version.&quot;);</a>
<a name="ln1670">        break;</a>
<a name="ln1671">    case QAppImageUpdateEnums::Error::CannotOpenTargetFile:</a>
<a name="ln1672">        errorString = QString::fromUtf8(&quot;The new version cannot be opened to write or read.&quot;);</a>
<a name="ln1673">        break;</a>
<a name="ln1674">    case QAppImageUpdateEnums::Error::TargetFileSha1HashMismatch:</a>
<a name="ln1675">        errorString = QString::fromUtf8(&quot;The newly constructed AppImage failed the integrity check, please try again.&quot;);</a>
<a name="ln1676">        break;</a>
<a name="ln1677">    case QAppImageUpdateEnums::Error::UnsupportedActionForBuild:</a>
<a name="ln1678">        errorString = QString::fromUtf8(&quot;The current build of the core library does not support the requested action.&quot;);</a>
<a name="ln1679">        break;</a>
<a name="ln1680">    case QAppImageUpdateEnums::Error::InvalidAction:</a>
<a name="ln1681">        errorString = QString::fromUtf8(&quot;The requested action is invalid.&quot;);</a>
<a name="ln1682">        break;</a>
<a name="ln1683">    default:</a>
<a name="ln1684">        errorString = QString::fromUtf8(&quot;Unknown error.&quot;);</a>
<a name="ln1685">        break;</a>
<a name="ln1686">    }</a>
<a name="ln1687">    return errorString;</a>
<a name="ln1688">}</a>
<a name="ln1689"> </a>
<a name="ln1690">QString QAppImageUpdatePrivate::versionString() {</a>
<a name="ln1691">    return QString::fromUtf8(&quot;2.0.0&quot;);</a>
<a name="ln1692">}</a>

</code></pre>
<div class="balloon" rel="231"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1048/" target="_blank">V1048</a> The 'b_Running' variable was assigned the same value.</p></div>
<div class="balloon" rel="231"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1048/" target="_blank">V1048</a> The 'b_Started' variable was assigned the same value.</p></div>
<div class="balloon" rel="485"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v1048/" target="_blank">V1048</a> The 'b_Canceled' variable was assigned the same value.</p></div>
<div class="balloon" rel="849"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v519/" target="_blank">V519</a> The 'b_Canceled' variable is assigned values twice successively. Perhaps this is a mistake. Check lines: 847, 849.</p></div>
<div class="balloon" rel="972"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v519/" target="_blank">V519</a> The 'b_Canceled' variable is assigned values twice successively. Perhaps this is a mistake. Check lines: 970, 972.</p></div>
<div class="balloon" rel="1022"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v636/" target="_blank">V636</a> The 'bytesReceived / 1048576' expression was implicitly cast from 'long long' type to 'double' type. Consider utilizing an explicit type cast to avoid the loss of a fractional part. An example: double A = (double)(X) / Y;.</p></div>
<div class="balloon" rel="1023"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v636/" target="_blank">V636</a> The 'bytesTotal / 1048576' expression was implicitly cast from 'long long' type to 'double' type. Consider utilizing an explicit type cast to avoid the loss of a fractional part. An example: double A = (double)(X) / Y;.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
